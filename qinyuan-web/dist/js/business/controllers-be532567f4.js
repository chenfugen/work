"use strict";app.controller("AppController",["$scope","$http","$location","$rootScope",function(o,e,t,s){var a=JSON.parse(sessionStorage.getItem("root"));o.user=JSON.parse(localStorage.getItem("user")),o.navList="root"!=a&&null!=a?a:module;var n=sessionStorage.getItem("module"),r=sessionStorage.getItem("pageIndex");null!=r?(o.selected=n,o.pageIndex=r):(o.selected=0,o.pageIndex=0),sessionStorage.setItem("permission",JSON.stringify(o.navList[o.selected].children[o.pageIndex].children)),o.selectMode=function(e,t){sessionStorage.getItem("module")!=t?o.pageIndex=-1:o.pageIndex=sessionStorage.getItem("pageIndex"),o.selected=e!=t?t:100},o.selectPage=function(e,t,s){e.stopPropagation(),o.pageIndex=t,sessionStorage.setItem("module",s),sessionStorage.setItem("pageIndex",t)},o.loginOut=function(){dataRequest("post","manage/userAccount/logout","",function(e){e.success?(delCookie("token"),sessionStorage.clear(),window.location.href="index.html"):$(".loginErr").text(e.message)})},o.go=function(e){sessionStorage.setItem("permission",JSON.stringify(e.children)),t.path("/"+e.childId+"/"+Math.random())},$.get(config.webAPI.address+"common/getProductType/list",function(e){e.success&&sessionStorage.setItem("productType",JSON.stringify(e.data))}),$.get(config.webAPI.address+"common/getNetType/list",function(e){e.success&&sessionStorage.setItem("netType",JSON.stringify(e.data))}),$.get(config.webAPI.address+"common/getProductName/list",function(e){e.success&&sessionStorage.setItem("productNameList",JSON.stringify(e.data))}),o.str=1,o.toggler_nav=function(){1==o.str?($(".layui-side").animate({width:"0px"}),$(".layui-body").animate({left:"0px"}),o.str=0):($(".layui-side").animate({width:"200px"}),$(".layui-body").animate({left:"200px"}),o.str=1)},window.addEventListener("hashchange",function(e){200!=$(".layui-side").width()&&($(".layui-side").animate({width:"200px"}),$(".layui-body").animate({left:"200px"}),o.str=1)})}]),app.controller("managerDetailsC",["$scope","$http","$location","$rootScope",function(e,t,s,o){e.edit=function(){$(".layui-layer-shade").show(),$(".layui-layer").show(),e.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide()},e.save=function(){}}}]),app.controller("personalC",["$scope","$http","$location","$rootScope",function(s,e,t,o){s.init=function(){dataRequest("get","manage/userAccount/detail","",function(e){s.item=e.data,s.$apply()})},s.init(),s.listData=[],s.filter=[],s.resetForm={userName:"",password:"",rePassword:""},s.deleteForm={id:""},dataRequest("GET","manage/role/list",{pageNum:1,pageSize:10},function(e){s.roleList=e.data,s.$apply()}),s.loginOut=function(){dataRequest("post","manage/userAccount/logout","",function(e){e.success?(delCookie("token"),sessionStorage.clear(),window.location.href="index.html"):$(".loginErr").text(e.message)})},s.dialog=function(e,t){"reset"==(s.fun=e)&&(s.resetForm.id=t),"edit"==e&&(s.userName=t.userName,s.phone=t.phone,s.realName=t.realName,s.sex=t.sex,s.id=t.id),$(".layui-layer-shade").show(),$(".popoutOne").show()},s.close=function(){$(".layui-layer-shade").hide(),$(".popoutOne").hide()};var a={check:{enable:!0},view:{showIcon:!(s.beforeSubmit=function(){if("reset"==s.fun){if(""==s.resetForm.password)return alert("请输入新密码！"),!1;if(s.resetForm.password.length<6)return alert("密码不能少于6位！"),!1;if(!/[0-9]+[a-zA-Z]+[0-9a-zA-Z]*|[a-zA-Z]+[0-9]+[0-9a-zA-Z]*/.test(s.resetForm.password))return alert("请输入数字与字母组合的密码！"),!1;if(""==s.resetForm.rePassword)return alert("请再次输入新密码！"),!1;if(s.resetForm.rePassword!=s.resetForm.password)return alert("两次密码输入不同,请确认密码!"),!1;s.close();var e=hex_md5(s.resetForm.password).toUpperCase();dataRequest("POST","manage/userAccount/reset/password",{id:s.resetForm.id,password:e},function(e){e.success?(alert("密码重置成功!"),$(".layui-layer-shade").show(),$(".popoutTwo").show(),s.save=function(){s.loginOut()}):alert(e.message)})}if("edit"==s.fun){if(null==s.userName)return alert("请输入用户姓名!"),!1;if(null==s.phone||11!=s.phone.length)return alert("请输入正确的联系方式!"),!1;if(null==s.realName)return alert("请输入姓名!"),!1;if(null==s.roleId)return alert("请选择角色类型!"),!1;if(null==s.sex)return alert("请选择性别!"),!1;s.close(),dataRequest("POST","manage/userAccount/update",{id:s.id,userName:s.userName,realName:s.realName,sex:s.sex,roleId:s.roleId,phone:s.phone},function(e){e.success?(alert("编辑成功!"),s.init()):alert(e.message)})}})},data:{key:{url:"notexists"}}};s.treeInit=function(e){dataRequest("GET","manage/role/detail",{roleId:e},function(e){s.trees=e.data.permissions,s.$apply(),e.data.permissions&&e.data.permissions.forEach(function(e){e.open=!0}),$.fn.zTree.init($(treeDemo),a,e.data.permissions)})},s.str=1,s.lookOver=function(e,t){s.roleName=e,1==s.str?(s.treeInit(t),$(".roleList").animate({width:"72%"},function(){$(".back").css({height:$(".roleList").height(),display:"block"}),$(".limit").css({display:"block"})}),s.str=0):($(".back").hide(),$(".limit").css({display:"none"}),$(".roleList").animate({width:"94%"}),s.str=1)}}]);
app.controller("managerListC",["$scope","$http","$location","$routeParams",function(u,e,a,t){0<t.random.indexOf("?")&&(u.roleName=t.random.split("?")[1]),JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/userAccount/create"==e.url&&(u.isAdd=e.checked),"/web/api/manage/userAccount/update"==e.url&&(u.isUpdate=e.checked),"/web/api/manage/userAccount/detail"==e.url&&(u.isDetail=e.checked),"/web/api/manage/userAccount/delete"==e.url&&(u.isDelete=e.checked),"/web/api/manage/userAccount/used"==e.url&&(u.start=e.checked),"/web/api/manage/userAccount/forbidden"==e.url&&(u.off=e.checked),"/web/api/manage/userAccount/reset/password"==e.url&&(u.reset=e.checked)}),u.listData=[],u.filter=[],u.resetForm={userName:"",password:"",rePassword:""},u.deleteForm={id:""},u.dialog=function(e,a){if("add"!=e&&"root"==a.userName)return alert("超级管理员暂时无法操作！"),!1;"reset"==(u.fun=e)&&(u.resetForm.id=a.id),"delete"==e&&(u.deleteForm.id=a.id),"edit"==e&&(u.userName=a.userName,u.phone=a.phone,u.realName=a.realName,u.rolename=a.roleName,u.sex=a.sex,u.id=a.id,u.roleList.forEach(function(e){u.id==e.id&&(u.rolename=e.roleName)})),"add"==e&&(u.userName=void 0,u.password=void 0,u.phone=void 0,u.realName=void 0,u.sex=void 0,u.role=void 0),"start"==e&&(u.startId=a.id),"stop"==e&&(u.stopId=a.id),$(".layui-layer-shade").show(),$(".popoutOne").show()},u.close=function(){$(".layui-layer-shade").hide(),$(".popoutOne").hide()},u.beforeSubmit=function(){if("reset"==u.fun){if(""==u.resetForm.password)return alert("请输入新密码！"),!1;if(u.resetForm.password.length<6)return alert("密码不能少于6位！"),!1;if(!/[0-9]+[a-zA-Z]+[0-9a-zA-Z]*|[a-zA-Z]+[0-9]+[0-9a-zA-Z]*/.test(u.resetForm.password))return alert("请输入数字与字母组合的密码！"),!1;if(""==u.resetForm.rePassword)return alert("请再次输入新密码！"),!1;if(u.resetForm.rePassword!=u.resetForm.password)return alert("两次密码输入不同,请确认密码!"),!1;u.close();var e=hex_md5(u.resetForm.password).toUpperCase();dataRequest("POST","manage/userAccount/reset/password",{id:u.resetForm.id,password:e},function(e){e.success?(alert("密码重置成功!"),u.getListData("","","","","","","","",1,10,!0)):alert(e.message)})}if("delete"==u.fun&&(u.close(),dataRequest("POST","manage/userAccount/delete",{id:u.deleteForm.id},function(e){e.success?(alert("删除成功!"),u.getListData("","","","","","","","",1,10,!0)):alert(e.message)})),"add"==u.fun||"edit"==u.fun){if(null==u.userName||""==u.userName)return alert("请输入用户名!"),!1;if(null==u.realName||""==u.realName)return alert("请输入姓名!"),!1;if(null==u.phone||11!=u.phone.length)return alert("请输入正确的联系方式!"),!1;if(null==u.rolename)return alert("请选择角色类型!"),!1;if(null==u.sex)return alert("请选择性别!"),!1;if("add"==u.fun){if(null==u.password||""==u.password)return alert("请输入密码!"),!1;if(u.password.length<6)return alert("密码不能少于6位！"),!1;if(!/[0-9]+[a-zA-Z]+[0-9a-zA-Z]*|[a-zA-Z]+[0-9]+[0-9a-zA-Z]*/.test(u.password))return alert("请输入数字与字母组合的密码！"),!1;u.roleList.forEach(function(e){u.rolename==e.roleName&&(u.roleId=e.id)});var a=hex_md5(u.password).toUpperCase();dataRequest("POST","manage/userAccount/create",{userName:u.userName,password:a,realName:u.realName,sex:u.sex,roleId:u.roleId,phone:u.phone},function(e){e.success?(alert("新增成功!"),u.getListData("","","","","","","","",1,10,!0),u.close()):alert(e.message)})}"edit"==u.fun&&(u.roleList.forEach(function(e){u.rolename==e.roleName&&(u.roleId=e.id)}),u.close(),dataRequest("POST","manage/userAccount/update",{id:u.id,userName:u.userName,realName:u.realName,sex:u.sex,roleId:u.roleId,phone:u.phone},function(e){e.success?(alert("编辑成功!"),u.getListData("","","","","","","","",1,10,!0)):alert(e.message)}))}"start"==u.fun&&(u.close(),dataRequest("POST","manage/userAccount/used",{id:u.startId},function(e){e.success?(alert("启用成功!"),u.getListData("","","","","","","","",1,10,!0)):alert(e.message)})),"stop"==u.fun&&(u.close(),dataRequest("POST","manage/userAccount/forbidden",{id:u.stopId},function(e){e.success?(alert("禁用成功!"),u.getListData("","","","","","","","",1,10,!0)):alert(e.message)}))},u.goDetail=function(e){a.path("/managerDetails/"+e)},layui.use(["form","layedit","laydate"],function(){layui.form,layui.layer,layui.layedit;layui.laydate.render({elem:"#date",type:"datetime",range:!0,done:function(e){u.startTime=e.slice(0,20),u.endTime=e.slice(22)}})}),u.getListData=function(e,a,t,i,r,n,s,o,l,c,d){dataRequest("GET","manage/userAccount/list",{roleName:e,sex:a,forbidden:t,creator:i,accountName:r,phone:n,startTime:s,endTime:o,pageNum:l,pageSize:c},function(e){u.listData=e.data,d&&pageUtils(e.total,"adminList",function(e){u.getListData(u.roleName,u.sex,u.forbidden,u.creator,u.accountName,u.accountPhone,u.startTime,u.endTime,e.curr,e.limit,!1)}),u.$apply()})},u.getListData(u.roleName,"","","","","","","",1,10,!0),dataRequest("GET","manage/role/list",{pageNum:1,pageSize:1e3},function(e){u.roleList=e.data,u.$apply()});var i={check:{enable:!0},view:{showIcon:!(u.search=function(){null==u.accountName&&(u.accountName=""),null==u.roleName&&(u.roleName=""),u.getListData(u.roleName,u.sex,u.forbidden,u.creator,u.accountName,u.accountPhone,u.startTime,u.endTime,1,10,!0)})},data:{key:{url:"notexists"}}};u.treeInit=function(e){dataRequest("GET","manage/role/detail",{roleId:e},function(e){u.trees=e.data.permissions,u.$apply(),e.data.permissions&&e.data.permissions.forEach(function(e){e.open=!0}),$.fn.zTree.init($(treeDemo),i,e.data.permissions)})},u.str=1,u.lookOver=function(e,a){u.roleName=e,1==u.str?(u.treeInit(a),$(".roleList").animate({width:"72%"},function(){$(".back").css({height:$(".roleList").height(),display:"block"}),$(".limit").css({display:"block"})}),u.str=0):($(".back").hide(),$(".limit").css({display:"none"}),$(".roleList").animate({width:"94%"}),u.str=1)}}]),app.controller("roleManageC",["$scope","$http","$location",function(n,e,a){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/role/create"==e.url&&(n.isAdd=e.checked),"/web/api/manage/role/update"==e.url&&(n.isUpdate=e.checked),"/web/api/manage/role/detail"==e.url&&(n.isDetail=e.checked),"/web/api/manage/role/delete"==e.url&&(n.isDelete=e.checked)}),n.initLaypage=function(e,a){n.total=e,n.pageSize=a,layui.use("laypage",function(){layui.laypage.render({elem:"roleList",count:e,limit:a,layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(n.pageNum=e.curr,n.pageSize=e.limit,n.getListData({pageNum:e.curr,pageSize:e.limit}))}})})},n.getRole=function(){dataRequest("GET","manage/role/list",{pageNum:1,pageSize:1e3},function(e){n.roleList=e.data,n.$apply()})},n.getRole(),n.dialog=function(e){$(".layui-layer-shade").show(),$(".popoutOne").show()},n.edit=function(e){a.path("/roleAdd")},n.getListData=function(a,t){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_role_list,data:_extends({},a),async:!0,dataType:"json",success:function(e){n.listData=e.data,n.$apply(),t&&n.initLaypage(e.total,a.pageSize)},error:function(e){console.log(e)}})},n.getListData({pageNum:1,pageSize:10},!0);var s,t={check:{enable:!0},view:{showIcon:!1},data:{key:{url:"notexists"}},callback:{onCheck:function(e,a){n.expression=!1,n.$apply()}}};n.treeInit=function(e,a){e?dataRequest("GET","common/account/permission/list","",function(e){e.data.forEach(function(e){e.checked=!1,e.open=!0,e.children.forEach(function(e){e.checked=!1,e.children.forEach(function(e){e.checked=!1})})}),$.fn.zTree.init($(treeDemo),t,e.data)}):dataRequest("GET","manage/role/detail",{roleId:a},function(e){console.log(JSON.stringify(e.data.permissions)),e.data.permissions.forEach(function(e){e.open=!0}),$.fn.zTree.init($(treeDemo),t,e.data.permissions)}),$(".back").css({height:$(".roleList").height(),display:"block"})},n.checkAll=function(){$.fn.zTree.getZTreeObj("treeDemo").checkAllNodes(n.expression)},n.saveRole=function(){if(null==n.roleName||""==n.roleName)return alert("请填写新增角色名！"),!1;var e=$.fn.zTree.getZTreeObj("treeDemo").getNodes(),a=[];for(var t in e)for(var i in a[t]={},a[t].children=[],a[t].name=e[t].name,a[t].checked=e[t].checked,a[t].moduleId=e[t].moduleId,e[t].children)for(var r in a[t].children[i]={},a[t].children[i].children=[],a[t].children[i].name=e[t].children[i].name,a[t].children[i].checked=e[t].children[i].checked,a[t].children[i].childId=e[t].children[i].childId,e[t].children[i].children)a[t].children[i].children[r]={},a[t].children[i].children[r].name=e[t].children[i].children[r].name,a[t].children[i].children[r].checked=e[t].children[i].children[r].checked,a[t].children[i].children[r].url=e[t].children[i].children[r].url;"新增"==$(".limitHeader").text()?dataRequest("post","manage/role/create",{roleName:n.roleName,permissions:JSON.stringify(a)},function(e){e.success?(alert("新增成功！"),n.getListData({pageNum:1,pageSize:10},!0),n.getRole(),n.clear()):(alert(e.message),n.treeInit(!0,""))}):dataRequest("post","manage/role/update",{roleName:n.roleName,id:s,permissions:JSON.stringify(a)},function(e){e.success?(alert("编辑成功！"),n.getListData({pageNum:1,pageSize:10},!0),n.clear()):(alert(e.message),n.treeInit(!1,s))})},n.str=1,n.add=function(){$(".limitHeader").text("新增"),n.roleName=void 0,n.saveButton=!0,n.expression=!1,1==n.str?(n.treeInit(!0,""),$(".roleList").animate({width:"70%"},function(){$(".limit").css({display:"block"})}),n.str=0):($(".limit").css({display:"none"}),$(".roleList").animate({width:"94%"}),n.str=1)},n.edit=function(e,a){if(n.expression=!1,"root"==e)return alert("超级管理员无法修改!"),!1;$(".limitHeader").text("编辑"),n.roleName=e,n.saveButton=!0,s=a,1==n.str?(n.treeInit(!1,a),$(".roleList").animate({width:"70%"},function(){$(".limit").css({display:"block"})}),n.str=0):($(".limit").css({display:"none"}),$(".roleList").animate({width:"94%"}),n.str=1)},n.delete=function(e,a){if("root"==e)return alert("超级管理员无法修改!"),!1;$(".layui-layer-shade").show(),$(".popoutOne").show(),n.close=function(){$(".layui-layer-shade").hide(),$(".popoutOne").hide()},n.save=function(){n.close(),dataRequest("post","manage/role/delete",{roleId:a},function(e){e.success?(alert("删除成功！"),n.getListData({pageNum:1,pageSize:10},!0)):alert(e.message)})}},n.lookOver=function(e,a){$(".limitHeader").text("查看"),n.roleName=e,n.saveButton=!1,1==n.str?(n.treeInit(!1,a),$(".roleList").animate({width:"70%"},function(){$(".limit").css({display:"block"})}),n.str=0):($(".limit").css({display:"none"}),$(".roleList").animate({width:"94%"}),n.str=1)},n.clear=function(){$(".limit").css({display:"none"}),$(".roleList").animate({width:"94%"}),n.str=1,$(".back").hide()},n.search=function(){n.getListData({pageNum:1,pageSize:10,roleName:n.rolename},!0)},n.goManage=function(e){a.path("/managerList/"+Math.random()+"?"+e)}}]),app.controller("messageFeedbackC",["$scope","$http","$location","$rootScope",function(o,e,a,t){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/feedBack/detail"==e.url&&(o.isDetail=e.checked),"/web/api/manage/feedBack/list"==e.url&&(o.isSearch=e.checked),"/web/api/manage/feedBack/updateFeedBackFeedContent"==e.url&&(o.feedBack=e.checked)}),o.filter={status:"",endTime:"",startTime:"",phone:"",feedBackUser:""},o.form={},o.initLaypage=function(e,a){o.total=e,o.pageSize=a,pageUtils(e,"messageFeedbackPage",function(e){o.getListData({pageNum:e.curr,pageSize:e.limit})})},layui.use(["form","layedit","laydate"],function(){layui.form,layui.layer,layui.layedit;layui.laydate.render({elem:"#date",type:"datetime",btns:["clear","confirm"],range:!0,done:function(e,a,t){e<1?(o.filter.startTime="",o.filter.endTime=""):(o.filter.startTime=e.slice(0,20),o.filter.endTime=e.slice(22))}})}),o.dialog=function(e,a){o.fun=e,o.form.id=a,"info"==e&&o.getInfoData(),$(".layui-layer-shade").show(),$(".popoutOne").show()},o.getInfoData=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_feedBack_detail,data:{id:o.form.id},async:!0,dataType:"json",success:function(e){o.form=e.data,o.$apply()},error:function(e){console.log(e)}})},o.close=function(){$(".layui-layer-shade").hide(),$(".popoutOne").hide(),o.form={}},o.save=function(){if("reply"==o.fun){if(100<o.form.content.length)return alert("您的反馈的内容过长！"),!1;var e=apiConfig.manage_feedBack_updateFeedBackFeedContent,a={content:o.form.content,id:o.form.id};$.ajax({type:"post",url:config.webAPI.address+e,data:_extends({},a),async:!0,dataType:"json",success:function(e){e.success?(alert("成功！"),o.close(),o.getListData({pageNum:1,pageSize:10})):alert(e.message)},error:function(e){console.log(e)}})}else o.close()},o.getListData=function(n,s){""!=o.filter.startTime&&""!=o.filter.endTime||(o.filter.startTime="",o.filter.endTime=""),$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_feedBack_list,data:_extends({},n,o.filter),async:!0,dataType:"json",success:function(e){for(var a in o.listData=e.data,o.listData)if(null!=o.listData[a].username){for(var t=o.listData[a].username.length,i="",r=1;r<t;r++)i+="*";o.listData[a].username=o.listData[a].username[0]+i}o.$apply(),s&&o.initLaypage(e.total,n.pageSize)},error:function(e){console.log(e)}})},o.getListData({pageNum:1,pageSize:10},!0)}]),app.controller("systemMaintenanceC",["$scope","$http","$location","$rootScope",function(a,e,t,i){var r="";a.init=function(){a.form={expireTime:"",status:"",content:"2019-8-1 15:00:00"};var e=apiConfig.getSystemMaintainConfigInfo;dataRequest("GET",e,{},function(e){a.form=e.data,a.form.status=1==e.data.status?"开启":"停用",a.$apply()})},a.handleSubmit=function(){r=apiConfig.saveSystemMaintainConfig;var e=JSON.parse(JSON.stringify(a.form));return""==a.form.content?(alert("请填写消息内容"),!1):""==a.form.status?(alert("请选择状态"),!1):(e.status="开启"==a.form.status?"1":"0",void dataRequest("POST",r,e,function(e){alert(e.message),a.$apply()}))},a.init()}]);
"use strict";app.controller("advertManageC",["$scope","$http","$location","$rootScope",function(i,e,a,t){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/advertise/add"==e.url&&(i.isAdd=e.checked),"/web/api/manage/advertise/update"==e.url&&(i.isUpdate=e.checked),"/web/api/manage/product/detail"==e.url&&(i.isDetail=e.checked),"/web/api/manage/advertise/delete"==e.url&&(i.isDelete=e.checked),"/web/api/manage/advertise/change"==e.url&&(i.isChange=e.checked)}),i.btnEdit=["layui-btn","layui-btn-sm","layui-btn-normal"],i.btnDelete=["layui-btn","layui-btn-sm","layui-btn-danger"],i.btnDisable=["layui-btn","layui-btn-sm","layui-btn-disabled"],i.filter={name:"",used:""},i.form={name:"",content:"",link:""},i.initLaypage=function(e,a){i.total=e,i.pageSize=a,layui.use("laypage",function(){layui.laypage.render({elem:"advListPage",count:e,limit:a,layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(i.pageNum=e.curr,i.pageSize=e.limit,i.getDataList({pageNum:e.curr,pageSize:e.limit}))}})})},i.getInfoData=function(e){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_advertise_selectOne,data:{id:e},async:!0,dataType:"json",success:function(e){i.form=e.data,i.$apply()},error:function(e){console.log(e)}})},i.getDataList=function(a,t){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_advertise_list,data:_extends({},a,i.filter),async:!0,dataType:"json",success:function(e){i.listData=e.data,i.$apply(),t&&i.initLaypage(e.total,a.pageSize)},error:function(e){console.log(e)}})},i.close=function(){$(".layui-layer-shade").hide(),i.dialogStyle={display:"none"},i.form={name:"",content:"",link:""}},i.save=function(){var e={},a="";if("stop"==i.fun){e={id:i.adverId,used:1};a=apiConfig.manage_advertise_change;i.submit(e,a)}else if("start"==i.fun){e={id:i.adverId,used:2};a=apiConfig.manage_advertise_change;i.submit(e,a)}else if("delete"==i.fun){e={id:i.adverId};a=apiConfig.manage_advertise_delete;i.submit(e,a)}else i.submitFile()},i.submit=function(e,a){$.ajax({type:"post",url:config.webAPI.address+a,data:_extends({},e),async:!0,dataType:"json",success:function(e){e.success?(alert("成功！"),i.close(),i.getDataList({pageNum:i.pageNum,pageSize:i.pageSize},!0)):alert(e.message)},error:function(e){console.log(e)}})},i.submitFile=function(){var e="edit"==i.fun?apiConfig.manage_advertise_update:apiConfig.manage_advertise_add,a=document.getElementById("form_edit"),t=new FormData(a);"edit"==i.fun&&t.append("id",i.adverId),"add"==i.fun&&t.append("used",1);t.get("name").length<1?alert("请输入广告名称!"):1048576<t.get("multipartFile").size&&"add"==i.fun?alert("上传图片超出1M大小!"):"image/jpeg"!=t.get("multipartFile").type&&"image/png"!=t.get("multipartFile").type&&"add"==i.fun?alert("图片格式有误,请选择jpg或png格式图片!"):t.get("multipartFile").size<1&&"add"==i.fun?alert("请选择图片!"):/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?/.test(t.get("link"))?$.ajax({type:"post",cache:!1,url:config.webAPI.address+e,processData:!1,contentType:!1,data:t,async:!0,success:function(e){e.success?(alert("成功!"),i.close(),i.getDataList({pageNum:i.pageNum,pageSize:i.pageSize},!0),i.form={name:"",content:"",link:""}):alert(e.message)},error:function(e){console.log(e)}}):alert("请输入正确的广告链接!")},i.dialog=function(e,a){i.fun=a,i.adverId=e,"edit"==i.fun&&(i.getInfoData(e),i.api=apiConfig.manage_advertise_update),"add"==i.fun&&(i.api=apiConfig.manage_advertise_add),"edit"==i.fun||"add"==i.fun?i.dialogStyle={zIndex:19891015,width:"600px",height:"300px",top:"20%",left:"50%",marginLeft:"-200px"}:i.dialogStyle={zIndex:19891015,width:"470px",height:"150px",top:"40%",left:"50%",marginLeft:"-200px"},$(".layui-layer-shade").show()},i.getDataList({pageNum:1,pageSize:10},!0)}]);
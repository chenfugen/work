"use strict";app.controller("cardManageC",["$scope","$http","$location",function(o,e,a){o.tableSwitch="a",o.flowPool={},o.timer=null,o.showProgress=!1,o.dialogExportVisiable=!1,o.forbiddenForm={},o.showActList=!1,o.packageList=[],o.dialogStyle={zIndex:19891015,width:"400px",height:"170px",top:"30%",left:"50%",marginLeft:"-200px"},o.dialogVisiable=!1,o.dialogInfoVisiable=!1,o.simInfo={},o.cardStatusList=[{value:"00",label:"正常"},{value:"01",label:"单项停机"},{value:"02",label:"停机"},{value:"03",label:"预销号"},{value:"04",label:"销号"},{value:"05",label:"过户"},{value:"06",label:"休眠"},{value:"07",label:"待激活"},{value:"99",label:"号码不存在"}],o.cardLifeCycleList=[{value:"正式期",label:"正式期"},{value:"测试期",label:"测试期"},{value:"沉默期",label:"沉默期"},{value:"其他",label:"其他"}],o.productList=JSON.parse(sessionStorage.getItem("productNameList")),dataRequest("get",apiConfig.manage_product_list,_extends({pageNum:1,pageSize:1e3,netType:"NET_GPRS"}),function(e){o.productList=e.data,o.$apply()}),o.handleOrderTableList=function(){var e=o.form.orderBy;o.form.orderBy=1==e?"-1":1,o.handleSearch()},o.handleOrderOnline=function(){var e=o.form.onlineOrderBy;o.form.onlineOrderBy=1==e?"-1":1,o.handleSearch()},o.productTypeList=JSON.parse(sessionStorage.getItem("productType")),o.getGPRSPackageList=function(){dataRequest("get",apiConfig.manage_v2_simCard_getPackageList,"",function(e){o.packageList=e.data,o.$apply()})},o.form={orderBy:1,onlineOrderBy:1,cardStatus:"",productKey:"",productType:"",mealName:"",iccid:"",identityId:"",snCode:"",year:"",month:"",surpass:"",unusedMonths:"",lifeCycle:""},o.init=function(e,a,t,i){dataRequest("get",apiConfig.manage_v2_simCard_getSimCardList,_extends({pageNum:e,pageSize:a},t),function(e){o.CardList=e.data,i&&pageUtils(e.total,"CardList",function(e){o.init(e.curr,e.limit,o.form,!1)}),o.$apply()})},o.dialog=function(e){o.dialogStyle={zIndex:19891015,width:"400px",height:"170px",top:"30%",left:"50%",marginLeft:"-200px"},$(".layui-layer-shade").show(),o.forbiddenForm=e,o.dialogVisiable=!0},o.close=function(){$(".layui-layer-shade").hide(),o.dialogVisiable=!1,o.dialogExportVisiable=!1,o.dialogInfoVisiable=!1},o.handleExport=function(){o.dialogStyle={zIndex:19891015,width:"450px",height:"170px",top:"30%",left:"50%",marginLeft:"-200px"},$(".layui-layer-shade").show(),o.dialogExportVisiable=!0},o.handleExportStart=function(e){dataRequest("get",apiConfig.manage_exportSim,e,function(e){o.showProgress=!0,o.handleWatchProgress(e.message),o.close(),o.$apply()})},o.handleWatchProgress=function(e){o.timer=setInterval(function(){dataRequest("get",apiConfig.manage_progress,{processId:e},function(e){o.handleSetProgress(e.data),console.log(e.data),o.$apply()})},5e3)},o.handleInfo=function(e){dataRequest("get",apiConfig.manage_v2_simCard_getSimCardInfo,{iccid:e.iccid},function(e){o.simInfo=e.data,o.$apply()}),e.deviceId&&dataRequest("get",apiConfig.manage_device_detail,{id:e.deviceId},function(e){o.deviceInfo=e.data,o.$apply()}),dataRequest("get",apiConfig.manage_v2_simCard_getPackageInfo,{iccid:e.iccid},function(e){o.packageInfo=e.data.result[0].prodinfos,o.$apply()}),dataRequest("get",apiConfig.manage_v2_simCard_getSimCardRecentFlowCount,{iccid:e.iccid},function(e){o.flowInfo=e.data;var a=[];for(var t in o.flowInfo)a.push({month:t.split((new Date).getFullYear())[1],flow:o.flowInfo[t]});o.flowInfo=a.reverse(),o.$apply()}),$(".layui-layer-shade").show(),o.dialogInfoVisiable=!0,o.dialogStyle={zIndex:19891015,width:"80%",top:"10%",left:"15%"}},o.handleStopReply=function(e){var a="";a="00"==o.forbiddenForm.cardStatus?apiConfig.manage_v2_simCard_closeSim:apiConfig.manage_v2_simCard_openSim;var t={msisdn:o.forbiddenForm.msisdn};dataRequest("post",a,t,function(e){alert(e.message),o.init(1,10,o.form,!0),o.close(),o.$apply()})},o.getSimPoolInfo=function(){dataRequest("get",apiConfig.manage_v2_simCard_getGroupFlowPool,"",function(e){o.flowPool=e.data,o.$apply()})},o.handleRefreshFlowData=function(){alert("后台数据量较大，该操作可能需要花费较长时间。响应超时请刷新页面。"),dataRequest("post",apiConfig.manage_v2_simCard_refresh,"",function(e){o.init(1,10,o.form,!0),o.getSimPoolInfo(),o.getGPRSPackageList(),o.$apply()})},o.handleSearch=function(e){if(console.log(o.form),void 0===o.form.unusedMonths||void 0===o.form.surpass)return alert("查询条件输入有误，请重新输入"),o.form.unusedMonths=0,o.form.surpass=0,!1;if("a"==o.tableSwitch){if((""!=o.form.year||void 0===o.form.year)&&""===o.form.surpass||""==o.form.year&&""!=o.form.surpass)return alert("筛选超流量数据请填写完整时间与流量数"),!1;e?o.handleExportStart(o.form):o.init(1,10,o.form,!0)}else e?o.handleExportStart(o.form):o.init(1,10,o.form,!0)},o.handleSetProgress=function(e){var a=100*e.progress;layui.use("element",function(){layui.element.progress("demo",a+"%")}),console.log(a),100==a&&(o.showProgress=!1,clearInterval(o.timer),window.open(apiConfig.getFilesAfterDelete+"?id="+e.downloadUrl))},layui.use("element",function(){layui.element.on("tab(cardManageTab)",function(e){1==e.index?(o.tableSwitch="b",o.CardList=[]):(o.tableSwitch="a",o.init(1,10,o.form,!0)),o.form={orderBy:1,cardStatus:"",productType:"",productKey:"",mealName:"",iccid:"",identityId:"",snCode:"",year:"",month:"",surpass:"",unusedMonths:"",lifeCycle:""},o.$apply()})});var t=(new Date).getFullYear(),i=(new Date).getMonth()+1,n=(new Date).getDate(),l=t+"-"+i+"-"+n,r=--t+"-"+i+"-"+n;layui.use("laydate",function(){layui.laydate.render({elem:"#networkDate",type:"month",min:r,max:l,done:function(e,a){o.form.year=a.year,o.form.month=a.month}})}),o.init(1,10,o.form,!0),o.getSimPoolInfo(),o.getGPRSPackageList()}]),app.controller("statisticsC",["$scope","$http","$location",function(o,e,a){o.tableSwitch="a",o.showActList=!1,o.cardStatusList=[{value:"00",label:"正常"},{value:"01",label:"单项停机"},{value:"02",label:"停机"},{value:"03",label:"预销号"},{value:"04",label:"销号"},{value:"05",label:"过户"},{value:"06",label:"休眠"},{value:"07",label:"待激活"},{value:"99",label:"号码不存在"}],dataRequest("get",apiConfig.manage_product_list,_extends({pageNum:1,pageSize:1e3,netType:"NET_GPRS"}),function(e){o.productList=e.data,o.$apply()}),o.productTypeList=JSON.parse(sessionStorage.getItem("productType")),o.form={cardStatus:"",productKey:"",productType:"",iccid:"",identityId:"",snCode:""},o.handleSearch=function(){o.init(1,10,o.form,!0)},o.handleInfo=function(e){dataRequest("get",apiConfig.manage_v2_simCard_getSimCardInfo,{iccid:e.iccid},function(e){o.simInfo=e.data,o.$apply()}),e.deviceId&&dataRequest("get",apiConfig.manage_device_detail,{id:e.deviceId},function(e){o.deviceInfo=e.data,o.$apply()}),dataRequest("get",apiConfig.manage_v2_simCard_getPackageInfo,{iccid:e.iccid},function(e){o.packageInfo=e.data.result[0].prodinfos,o.$apply()}),dataRequest("get",apiConfig.manage_v2_simCard_getSimCardRecentFlowCount,{iccid:e.iccid},function(e){o.flowInfo=e.data;var a=[];for(var t in o.flowInfo)a.push({month:t.split((new Date).getFullYear())[1],flow:o.flowInfo[t]});o.flowInfo=a.reverse(),o.$apply()}),$(".layui-layer-shade").show(),o.dialogInfoVisiable=!0,o.dialogStyle={zIndex:19891015,width:"80%",top:"10%",left:"15%"}},o.close=function(){$(".layui-layer-shade").hide(),o.dialogVisiable=!1,o.dialogInfoVisiable=!1},o.init=function(e,a,t,i){dataRequest("get",apiConfig.manage_simOperateRecord_getSimOperateRecordList,_extends({pageNum:e,pageSize:a},t),function(e){o.CardList=e.data,i&&pageUtils(e.total,"CardList",function(e){o.init(e.curr,e.limit,o.form,!1)}),o.$apply()})},o.init(1,10,o.form,!0)}]);
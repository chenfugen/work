app.controller("userListC",["$scope","$http","$location","$rootScope",function(n,e,a,t){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/user/detail/deviceList"==e.url&&(n.isList=e.checked),"/web/api/manage/user/detail"==e.url&&(n.isDetail=e.checked),"/web/api/manage/user/delete"==e.url&&(n.isDelete=e.checked)}),n.pageNum=1,n.pageSize=10,n.dialogStyle={display:"none"},n.filter={phone:"",region:"",wechatAccount:"",bindStatus:"",sex:"",provinceId:"",cityId:"",regionId:""},n.dialog=function(e,a){n.phone=e,n.userId=a,n.dialogStyle={zIndex:"19891015",width:"300px",height:"150px",top:"30%",left:"50%",marginLeft:"-150px"},$(".layui-layer-shade").show(),$(".layui-layer").show()},n.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide()},n.save=function(){var e=apiConfig.manage_user_delete,a={id:n.userId};libsAjax("post",e,a,function(e){1==e.success?(alert("成功!"),n.getListData({pageNum:n.pageNum,pageSize:n.pageSize},!0)):alert(e.message),n.close()})},n.initLaypage=function(e,a,t){layui.use("laypage",function(){layui.laypage.render({elem:"userListPage",count:Number(e),curr:Number(t),limit:Number(a),layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(n.pageSize=e.limit,n.getListData({pageNum:e.curr,pageSize:e.limit}),n.$apply())}})})},n.goDetail=function(e){a.path("/userDetails/"+e)},n.getListData=function(a,t){var e=apiConfig.manage_user_list;""!=n.region&&null!=n.region?(n.filter.provinceId=n.provinceId,n.filter.cityId=n.cityId,n.filter.regionId=n.regionId):(n.filter.provinceId="",n.filter.cityId="",n.filter.regionId="");var i=_extends({},a,n.filter);libsAjax("get",e,i,function(e){n.userList=e.data,n.total=e.total,t&&n.initLaypage(e.total,a.pageSize,a.pageNum)})},n.getListData({pageNum:1,pageSize:10},!0)}]),app.controller("userDetailsC",["$scope","$http","$location","$routeParams",function(n,e,a,t){n.dialogStyle={display:"none"},n.userId=t.id,n.initLaypage=function(e,a){layui.use("laypage",function(){layui.laypage.render({elem:"userDetailPage",count:e,limit:a,layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(n.pageSize=e.limit,n.getListData({pageNum:e.curr,pageSize:e.limit}),n.$apply())}})})},n.getUserInfo=function(){var e=apiConfig.manage_user_detail,a={userId:n.userId};libsAjax("get",e,a,function(e){n.userInfo=e.data})},n.shareUsers=function(e){dataRequest("GET","manage/device/detail/shareUser/list",{deviceId:e},function(e){n.sharelist=e.data,n.$apply()})},n.shareDevice=function(){dataRequest("GET","manage/user/share/device/list",{userId:n.userId},function(e){n.shareUser=e.data,n.$apply()})},n.shareDevice(),n.dialog=function(e,a){n.fun=e,n.deviceId=a,"untie"==e||"unbind"==e?n.dialogStyle={zIndex:"19891015",width:"350px",height:"150px",top:"20%",left:"50%",marginLeft:"-200px"}:(n.dialogStyle={zIndex:"19891015",width:"700px",maxHeight:"500px",height:"auto",top:"20%",left:"40%",marginLeft:"-200px"},n.shareUsers(n.deviceId)),$(".layui-layer-shade").show(),$(".layui-layer").show(),n.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide()},n.save=function(){if("untie"==n.fun){var e=apiConfig.manage_user_unbind_device,a={userId:n.userId,deviceId:n.deviceId};libsAjax("post",e,a,function(e){e.success?(alert("解绑成功！"),n.getListData({pageNum:1,pageSize:10},!0),n.close()):alert(e.message)}),n.shareDevice()}"unbind"==n.fun&&(dataRequest("POST","manage/device/unbind/shareUser",{userId:n.userId,deviceId:n.deviceId},function(e){e.success?(alert("解绑成功！"),n.shareDevice()):alert(e.message)}),n.close())}},n.getListData=function(a,t){var e=apiConfig.manage_user_detail_deviceList,i=_extends({userId:n.userId},a);libsAjax("get",e,i,function(e){n.listData=e.data,n.total=e.total,t&&n.initLaypage(e.total,a.pageSize)})},n.getUserInfo(),n.getListData({pageNum:1,pageSize:10},!0)}]),app.controller("userTrendC",["$scope","$http","$location","$rootScope",function(n,e,a,t){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/user/trend/list"==e.url&&(n.isList=e.checked),"/web/api/manage/user/trend/count"==e.url&&(n.isCount=e.checked)}),n.appType="",n.days=7,n.count={androidCount:"",iosCount:"",totalCount:""},n.initLaypage=function(e,a){layui.use("laypage",function(){layui.laypage.render({elem:"userTrendPage",count:n.total,limit:Number(a),layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(n.pageSize=e.limit,n.getListData({pageNum:e.curr,pageSize:e.limit},n.days,n.appType,!1),n.$apply())}})})},n.goDetail=function(e){a.path("/userDetails/"+e)},n.switchTab=function(e){n.days=e,n.getListData({pageNum:1,pageSize:10},n.days,n.appType,!0),n.getTopData(e)},n.switchTabItem=function(e){n.appType=e,n.getListData({pageNum:1,pageSize:10},n.days,n.appType,!0)},n.getListData=function(t,e,a,i){n.pageSize=t.pageSize,n.pageNum=t.pageNum,n.total=0,$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_user_trend_list,data:_extends({days:e,appType:a},t),async:!0,dataType:"json",success:function(e){for(var a in n.listdata=e.data,n.total=e.total,n.listdata)null!=n.listdata[a].phone&&(n.listdata[a].phone=dealPhone(n.listdata[a].phone));n.$apply(),i&&n.initLaypage(n.total,t.pageSize)},error:function(e){console.log(e)}})},n.getTopData=function(e){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_user_trend_count,data:{days:e},async:!0,dataType:"json",success:function(e){n.count=e.data,n.$apply()},error:function(e){console.log(e)}})},n.getListData({pageNum:1,pageSize:10},7,"",!0),n.getTopData(7)}]);
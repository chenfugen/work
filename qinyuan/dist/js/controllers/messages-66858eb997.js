"use strict";app.controller("messagesListC",["$scope","$http","$location","$rootScope",function(s,e,t,a){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/messageRecord/deleteMessageRecord"==e.url&&(s.isDelete=e.checked),"/web/api/manage/messageRecord/getMessageRecordAndUserInfoList"==e.url&&(s.isDetail=e.checked),"/web/api/manage/messageRecord/getMessageHistoryList"==e.url&&(s.isList=e.checked)}),s.isRegion=!1,s.msgInfo={},s.filter={pushType:"",msgType:""},s.userFilter={pushStatus:"",userPhone:"",province:"",city:"",region:""},layui.use(["form","layedit","laydate"],function(){layui.form,layui.layer,layui.layedit;layui.laydate.render({elem:"#date",type:"datetime",btns:["clear","confirm"],range:!0,done:function(e,t,a){e<1?(s.filter.startTime="",s.filter.endTime=""):(s.filter.startTime=e.slice(0,20),s.filter.endTime=e.slice(22))}})}),s.initLaypage=function(e,t){s.total=e,s.pageSize=t,layui.use("laypage",function(){layui.laypage.render({elem:"messageListPage",count:e,limit:t,layout:["count","prev","page","next","skip","limit"],jump:function(e,t){s.pageNum=e.curr,s.pageSize=e.limit,t||s.getListData({pageNum:e.curr,pageSize:e.limit})}})})},s.initInfoLaypage=function(e,t){layui.use("laypage",function(){layui.laypage.render({elem:"messageListInfoPage",count:e,limit:t,limits:[3],layout:["count","prev","page","next","skip","limit"],jump:function(e,t){t||s.getInfoListData({pageNum:e.curr,pageSize:e.limit})}})})},s.getMsgType=function(){dataRequest("get",apiConfig.manage_messageType_getMessageTypeList,{},function(e){s.msgTypeList=e.data,s.$apply()})},s.getMsgType(),s.dialog=function(e,t){s.fun=t,s.msgId=e,"info"==t?(s.dialogStyle={zIndex:19891015,width:"900px",height:"520px",top:"10%",left:"50%",marginLeft:"-450px"},s.messageId=e,s.getInfoListData({pageNum:1,pageSize:3},!0)):s.dialogStyle={zIndex:19891015,width:"300px",height:"150px",top:"20%",left:"50%",marginLeft:"-150px"},$(".layui-layer-shade").show(),$(".layui-layer").show()},s.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide()},s.save=function(){$.ajax({type:"post",url:config.webAPI.address+apiConfig.manage_messageRecord_deleteMessageRecord,data:{id:s.msgId},async:!0,dataType:"json",success:function(e){e.success?(alert("成功！"),s.close(),s.getListData({pageNum:s.pageNum,pageSize:s.pageSize},!0)):alert(e.message)},error:function(e){console.log(e)}})},s.getListData=function(t,a){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageRecord_getMessageHistoryList,data:_extends({},s.filter,t),async:!0,dataType:"json",success:function(e){s.listData=e.data,a&&s.initLaypage(e.total,t.pageSize),s.$apply()},error:function(e){console.log(e)}})},s.getListData({pageNum:1,pageSize:10},!0),s.getInfoListData=function(a,i){""!=s.region||null!=s.region?(s.userFilter.provinceId=s.provinceId,s.userFilter.cityId=s.cityId,s.userFilter.regionId=s.regionId):(s.userFilter.provinceId="",s.userFilter.cityId="",s.userFilter.regionId=""),$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageRecord_getMessageHistoryinfo,data:{id:s.messageId},async:!0,dataType:"json",success:function(e){s.msgInfo=e.data[0],s.$apply()},error:function(e){console.log(e)}}),$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageRecord_getMessageRecordList,data:_extends({msgId:s.messageId},a,s.userFilter),async:!0,dataType:"json",success:function(e){for(var t in s.infoListData=e.data,s.infoListData)""!=s.infoListData[t].phone&&null!=s.infoListData[t].phone&&(s.infoListData[t].phone=dealPhone(s.infoListData[t].phone));i&&s.initInfoLaypage(e.total,a.pageSize),s.$apply()},error:function(e){console.log(e)}})}}]),app.controller("pushRuleC",["$scope","$http","$location","$routeParams","$timeout",function(o,e,t,a,r){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/message/deleteMessageConfig"==e.url&&(o.isDelete=e.checked),"/web/api/manage/message/updateMessageConfigStatus"==e.url&&(o.isOn=e.checked),"/web/api/manage/message/getMessageConfigList"==e.url&&(o.isList=e.checked),"/web/api/manage/message/saveMessageConfig"==e.url&&(o.isSave=e.checked)}),o.showEdit=!1,o.addRule=!0,o.dialogStyle={display:"none"},o.btnEdit=["layui-btn","layui-btn-sm","layui-btn-normal"],o.btnDelete=["layui-btn","layui-btn-sm","layui-btn-danger"],o.btnDisable=["layui-btn","layui-btn-sm","layui-btn-disabled"],o.methodValue=["大于","等于","小于","大于等于","小于等于"],o.combTypeValue=["与","或"],o.pushOtherList={},o.pushWayList={app:!0,wayA:!0,wayB:!0},o.hou=[],o.min=[],o.delayTime={hou:"",min:""},o.form={productKey:"",ownProductKey:"",allProductConfig:"",msgType:"",content:"",enable:0,msgRules:[],pushType:"",delayTime:"",thirdPartyPush:"",scheduled:0},o.productAtt=[],o.filter={productKey:"",msgType:"",startTime:"",endTime:"",productModel:""},o.attributeShowList=[{type:"1",typeA:"1",typeB:"",typeC:"1",typeD:""}],layui.use(["form","layedit","laydate"],function(){layui.form,layui.layer,layui.layedit;var e=layui.laydate;e.render({elem:"#date",type:"datetime",range:!0,done:function(e,t,a){e.length<1?(o.filter.startTime="",o.filter.endTime=""):(o.filter.startTime=e.slice(0,20),o.filter.endTime=e.slice(22))}}),e.render({elem:"#relative",type:"time",done:function(e,t,a){e.length<1?(o.filter.startTime="",o.filter.endTime=""):(o.filter.startTime=e.slice(0,20),o.filter.endTime=e.slice(22))}})}),o.initLaypage=function(e,t){o.total=e,o.pageSize=t,layui.use("laypage",function(){layui.laypage.render({elem:"pushRulePage",count:e,limit:t,layout:["count","prev","page","next","skip","limit"],jump:function(e,t){o.pageNum=e.curr,o.pageSize=e.limit,t||o.getListData({pageNum:e.curr,pageSize:e.limit})}})})},o.getMsgType=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageType_getMessageTypeList,data:{},async:!0,dataType:"json",success:function(e){o.msgTypeList=e.data,o.$apply(),o.getListData({pageSize:10,pageNum:1},!0)},error:function(e){console.log(e)}})},o.getProductList=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.common_getProductName_list,data:{},async:!0,dataType:"json",success:function(e){o.productList=e.data,o.$apply()},error:function(e){console.log(e)}})},o.getListData=function(i,s){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_message_getMessageConfigList,data:_extends({},i,o.filter),async:!0,dataType:"json",success:function(e){o.listData=e.data;for(var t=1;t<=o.listData.length;t++)for(var a in o.listData[t-1].no=t,o.msgTypeList)o.listData[t-1].msgType==o.msgTypeList[a].id&&(o.listData[t-1].msgType=o.msgTypeList[a].typeName);o.total=e.total,o.$apply(),s&&o.initLaypage(e.total,i.pageSize)},error:function(e){console.log(e)}})},o.getTimeList=function(){for(var e=1;e<25;e++)o.hou.push(e);for(var t=1;t<61;t++)o.min.push(t)},o.getInfoData=function(e){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_message_getMessageConfigList,data:_extends({},o.filter,{pageNum:1,pageSize:10,id:e}),async:!0,dataType:"json",success:function(e){for(var t in o.form={id:e.data[0].id,productKey:e.data[0].productKey,msgType:e.data[0].msgType.toString(),content:e.data[0].content,enable:e.data[0].enable,msgRules:[],pushType:e.data[0].pushType,delayTime:e.data[0].delayTime,thirdPartyPush:e.data[0].thirdPartyPush,scheduled:e.data[0].scheduled},o.handleGetList(),o.attributeShowList=[],e.data[0].msgRules){var a={type:e.data[0].msgRules[t].combType.toString(),typeA:e.data[0].msgRules[t].paramType.toString(),typeB:e.data[0].msgRules[t].identifier+","+e.data[0].msgRules[t].identifierName||e.data[0].msgRules[t].errorId+","+e.data[0].msgRules[t].identifierName,typeC:e.data[0].msgRules[t].method.toString(),typeD:e.data[0].msgRules[t].value};o.attributeShowList.push(a)}o.$apply()},error:function(e){console.log(e)}})},o.resetData=function(e){if(3==e)return!1;1==e&&(o.form={productKey:"",allProductConfig:"",msgType:"",msgContent:"",enable:0,msgRules:[],pushType:"",delayTime:"",thirdPartyPush:""}),o.attributeShowList=[{type:"1",typeA:"1",typeB:"",typeC:"1",typeD:""}],o.productAtt=[]},o.handleTips=function(e){if(o.attributeShowList=[{typeA:e,typeB:"",typeC:"1",typeD:""}],""==o.form.productKey)return alert("请先选择产品类型！"),!1},o.handleGetList=function(){o.resetData(2),""!=o.form.productKey?($.ajax({type:"get",url:config.webAPI.address+"manage/product/getProductPropertiesInfo",data:{productKey:o.form.productKey},async:!0,dataType:"json",success:function(e){o.productAtt=e.properties,""==o.productAtt&&(o.productAtt=[],e.defineProperties.propertyList.forEach(function(e){o.productAtt.push(e.attr)})),o.$apply()},error:function(e){console.log(e)}}),dataRequest("get","manage/breakdown/getBreakdownList",{},function(e){o.errorList=e.data.list,o.$apply()})):alert("请选择产品类型！")},o.addPushRule=function(e){if(""==o.attributeShowList[e].typeB)return alert("请先选择具体故障/属性"),!1;if(""==o.attributeShowList[e].typeD)return alert("请先输入自定义内容"),!1;o.attributeShowList[0];o.attributeShowList.push({type:"1",typeA:"1",typeB:"",typeC:"1",typeD:""}),o.addRule=!1},o.deletePushRule=function(e){o.attributeShowList.splice(Number(e),1),1==o.attributeShowList.length&&(o.addRule=!0)},o.dialog=function(e,t){"edit"==(o.fun=e)?(o.form.id=t,o.dialogStyle={zIndex:19891015,overflow:"auto",width:"940px",height:"480px",top:"70px",left:"50%",marginLeft:"-350px"},o.getInfoData(t)):"add"==e?(o.dialogStyle={zIndex:19891015,overflow:"auto",width:"940px",height:"480px",top:"70px",left:"50%",marginLeft:"-350px"},o.form.id="",o.resetData(1),o.addRule=!0,o.form.scheduled=0):(o.form.id=t,o.dialogStyle={zIndex:19891015,width:"300px",height:"150px",top:"150px",left:"50%",marginLeft:"-200px"}),$(".layui-layer-shade").show(),$(".rule").show()},o.close=function(e){1==e?($(".layui-layer-shade").hide(),$(".rule").hide(),o.resetData(1)):2==e?($(".layui-layer-shade").hide(),$(".productAtrr").hide()):($(".layui-layer-shade").hide(),$(".layui-layer").hide())},o.save=function(){var e={},t="";if("delete"==o.fun)e={id:o.form.id},t=apiConfig.manage_message_deleteMessageConfig;else if("start"==o.fun)e={enable:1,id:o.form.id},t=apiConfig.manage_message_updateMessageConfigStatus;else{if("stop"!=o.fun)return void o.beforeSubmit();e={enable:0,id:o.form.id},t=apiConfig.manage_message_updateMessageConfigStatus}o.submit(e,t)},o.beforeSubmit=function(){var e=apiConfig.manage_message_saveMessageConfig;for(var t in 1==o.form.scheduled&&(o.form.delayTime=60*Number(o.delayTime.hou)+Number(o.delayTime.min)),o.pushWayList.wayA&&o.pushWayList.wayB?o.form.pushType=3:o.pushWayList.wayA&&!o.pushWayList.wayB?o.form.pushType=1:o.form.pushType=2,o.form.thirdPartyPush="",o.pushOtherList)o.pushOtherList[t]&&(o.form.thirdPartyPush=o.form.thirdPartyPush+t+",");if(""==o.form.content||null==o.form.content)return alert("请填写具体推送内容！"),!1;if(""==o.form.msgType)return alert("请选择消息类型！"),!1;if(100<o.form.content.length)return alert("您的推送内容长度大于100！"),!1;if(o.form.msgRules=[],1==o.attributeShowList[0].typeA)for(var t in o.attributeShowList){if(""==o.attributeShowList[t].typeB)return alert("请补全推送规则第"+(Number(t)+1)+"项具体故障/属性"),!1;if(""==o.attributeShowList[t].typeD)return alert("请补全推送规则第"+(Number(t)+1)+"项自定义内容"),!1;var a={paramType:o.attributeShowList[t].typeA,identifier:o.attributeShowList[t].typeB.split(",")[0],method:o.attributeShowList[t].typeC,value:o.attributeShowList[t].typeD,combType:0==t?"":o.attributeShowList[t].type,identifierName:o.attributeShowList[t].typeB.split(",")[1]};o.form.msgRules.push(a)}else{if(""==o.attributeShowList[0].typeB)return alert("请选择故障属性名称！"),!1;a={paramType:o.attributeShowList[0].typeA,identifier:o.attributeShowList[0].typeB.split(",")[0],method:2,value:1,identifierName:o.attributeShowList[0].typeB.split(",")[1]};o.form.msgRules.push(a)}o.form.msgRules=JSON.stringify(o.form.msgRules),o.submit(o.form,e)},o.submit=function(t,e){"all"==o.form.productKey?(t.productKey="",t.ownProductKey="",t.allProductConfig=1):(t.allProductConfig=2,o.productList.forEach(function(e){e.productKey==o.form.productKey&&(t.ownProductKey=e.ownProductKey)})),$.ajax({type:"post",url:config.webAPI.address+e,data:_extends({},t),async:!0,dataType:"json",success:function(e){e.success?(alert("成功！"),o.close(),o.getListData({pageNum:1,pageSize:o.pageSize},!0)):alert(e.message)},error:function(e){console.log(e)}})},o.getMsgType(),o.getProductList(),o.getTimeList(),o.lookRule=function(){if(""==o.form.productKey)return alert("请先选择产品类型！"),!1;$(".productAtrr").show(),o.propertieInit=function(e,t,a){for(var i=[],s=e;s<t;s++)null!=a[s]&&i.push(a[s]);r(function(){o.properties=i},0)},o.propertieInit(0,10,o.productAtt),pageUtils(o.productAtt.length,"productAll",function(e){o.propertieInit((e.curr-1)*e.limit,e.curr*e.limit,o.productAtt)})}}]),app.controller("pushMessageC",["$scope","$http","$location","$routeParams",function(i,e,t,a){i.userList=[],i.userFilter={phone:"",nickName:"",loginStatus:1},i.pushObject=0,i.productList={},i.pushWayList={app:!0,wayA:!0,wayB:!0},i.pushOtherList={},i.messageForm={productKey:"",msgType:"",msgContent:"",pushType:"",platformType:"",provinceId:"",cityId:"",regionId:"",userInfo:[],scheduled:0,scheduledTime:"",thirdPartyPush:""},layui.use(["form","layedit","laydate"],function(){layui.form,layui.layer,layui.layedit;layui.laydate.render({elem:"#date",type:"datetime",done:function(e,t,a){i.messageForm.scheduledTime=e}})}),i.remove=function(e,t){e?i.userList=[]:i.userList.splice(t,Number(t)+1)},i.getMessageTypeList=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageType_getMessageTypeList,data:{pageNum:1,pageSize:100},async:!0,dataType:"json",success:function(e){i.msgTypeList=e.data,i.$apply()},error:function(e){console.log(e)}})},i.getUserList=function(){if(""==i.userFilter.phone)return alert("请输入推送对象的手机号码进行添加！"),!1;$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_user_list,data:_extends({},i.userFilter,{pageNum:1,pageSize:1}),async:!0,dataType:"json",success:function(e){if(0<e.data.length){for(var t in i.userList)if(i.userList[t].phone==e.data[0].phone)return alert("该用户已添加至推送列表！"),!1;i.userList.push({nickName:e.data[0].nickName,realName:e.data[0].realName,address:e.data[0].address,provinceId:e.data[0].province,cityId:e.data[0].city,regionId:e.data[0].region,phone:e.data[0].phone,id:e.data[0].id}),i.$apply()}else alert("该用户不在线或不存在！")},error:function(e){console.log(e)}})},i.getProductList=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.common_getProductName_list,data:{},async:!0,dataType:"json",success:function(e){i.productList=e.data,i.$apply()},error:function(e){console.log(e)}})},i.Verification=function(){var e=i.messageForm;if(""==e.msgType)return alert("请选择消息类型！"),!1;if(""==e.msgContent)return alert("请填写消息内容！"),!1;if(500<e.msgContent.length)return alert("消息内容过长，长度为0-500个字符！"),!1;if(0==i.pushObject){if(""==i.messageForm.platformType)return alert("请选择用户类型！"),!1;if(""==i.address)return alert("请选择推送地区！"),!1;if("region"==i.address&&(""==i.region||null==i.region))return alert("请选择希望推送的省市！"),!1}if(1==i.pushObject&&0==i.userList.length)return alert("请添加您希望推送消息的用户！"),!1;if(1==e.scheduled){if(""==e.scheduledTime)return alert("请选择您希望推送的时间！"),!1;if((Number(new Date(e.scheduledTime))-Number(new Date))/1e3/60<5)return alert("请选择当前时间之后5分钟为发送时间！"),!1}i.beforeSubmit()},i.cancel=function(){i.messageForm={productKey:"",msgType:"",msgContent:"",pushType:"",platformType:"",provinceId:"",cityId:"",regionId:"",userInfo:[],scheduled:0,scheduledTime:"",thirdPartyPush:""}},i.submit=function(){$.ajax({type:"post",url:config.webAPI.address+apiConfig.manage_messageRecord_systemMessagePush,data:_extends({},i.messageForm),async:!0,dataType:"json",success:function(e){e.success?(alert("消息发送成功！"),document.location.reload()):alert(e.message)},error:function(e){console.log(e)}})},i.beforeSubmit=function(){for(var e in 1==i.pushObject?i.messageForm.userInfo=JSON.stringify(i.userList):("region"==i.address?(i.messageForm.provinceId=i.provinceId,i.messageForm.cityId=i.cityId):(i.messageForm.provinceId="",i.messageForm.cityId=""),i.messageForm.userInfo=[]),0==i.messageForm.scheduled&&(i.messageForm.scheduledTime=""),i.pushWayList.wayA&&i.pushWayList.wayB?i.messageForm.pushType=3:i.pushWayList.wayA&&!i.pushWayList.wayB?i.messageForm.pushType=1:i.messageForm.pushType=2,i.pushOtherList)i.pushOtherList[e]&&(i.messageForm.thirdPartyPush=i.messageForm.thirdPartyPush+e+",");i.submit()},i.getMessageTypeList(),i.getProductList(),i.checks=function(){i.pushWayList.app?(i.pushWayList.wayA=!0,i.pushWayList.wayB=!0):(i.pushWayList.wayA=!1,i.pushWayList.wayB=!1)},i.checkWay=function(){i.pushWayList.wayA&&i.pushWayList.wayB?i.pushWayList.app=!0:i.pushWayList.app=!1}}]),app.controller("pushObjectC",["$scope","$http","$location","$rootScope",function(s,e,t,a){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/messageSystem/deleteMessageSystem"==e.url&&(s.isDelete=e.checked),"/web/api/manage/message/getMessageConfigList"==e.url&&(s.isList=e.checked),"/web/api/manage/messageSystem/saveMessageSystem"==e.url&&(s.isSave=e.checked)}),s.form={systemName:"",systemUrl:""},s.dialogStyle={display:"none"},s.initLaypage=function(e,t){s.total=e,s.pageSize=t,layui.use("laypage",function(){layui.laypage.render({elem:"puObjectPage",count:e,limit:t,layout:["count","prev","page","next","skip","limit"],jump:function(e,t){t||(s.pageNum=e.curr,s.pageSize=e.limit,s.getListData({pageNum:e.curr,pageSize:e.limit}))}})})},s.dialog=function(e,t){s.fun=e,s.form.id=t,"edit"==e?(s.dialogStyle={zIndex:19891015,width:"600px",height:"300px",top:"30%",left:"50%",marginLeft:"-200px"},s.getInfoData(t)):s.dialogStyle="add"==e?{zIndex:19891015,width:"600px",height:"300px",top:"30%",left:"50%",marginLeft:"-200px"}:{zIndex:19891015,width:"300px",height:"150px",top:"30%",left:"50%",marginLeft:"-200px"},$(".layui-layer-shade").show(),$(".layui-layer").show()},s.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide(),s.form={systemName:"",systemUrl:""}},s.Verification=function(){if("edit"==s.fun||"add"==s.fun){if(""==s.form.systemName)return alert("请输入系统名称！"),!1;if(""==s.form.systemUrl)return alert("请输入系统链接！"),!1;if(!/(http|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?/.test(s.form.systemUrl))return alert("请输入正确的系统链接！"),!1;if(32<s.form.systemName.length)return alert("您的系统名称过长，请重新命名！"),!1}s.save()},s.save=function(){var e="",t={};t="delete"==s.fun?(e=apiConfig.manage_messageSystem_deleteMessageSystem,{id:s.form.id}):"add"==s.fun?(e=apiConfig.manage_messageSystem_saveMessageSystem,{systemName:s.form.systemName,systemUrl:s.form.systemUrl}):(e=apiConfig.manage_messageSystem_saveMessageSystem,{id:s.form.id,systemName:s.form.systemName,systemUrl:s.form.systemUrl}),s.submit(e,t)},s.submit=function(e,t){$.ajax({type:"post",url:config.webAPI.address+e,data:_extends({},t),async:!0,dataType:"json",success:function(e){e.success?(alert("成功！"),s.close(),s.getListData({pageNum:s.pageNum,pageSize:s.pageSize},!0)):alert(e.message)},error:function(e){console.log(e)}})},s.getInfoData=function(e){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageSystem_getMessageSystemList,data:{id:e},async:!0,dataType:"json",success:function(e){s.form=e.data[0],s.$apply()},error:function(e){console.log(e)}})},s.getListData=function(a,i){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageSystem_getMessageSystemList,data:_extends({},s.filter,a),async:!0,dataType:"json",success:function(e){s.listData=e.data;for(var t=1;t<=s.listData.length;t++)s.listData[t-1].no=t;s.$apply(),i&&s.initLaypage(e.total,a.pageSize)},error:function(e){console.log(e)}})},s.getListData({pageNum:1,pageSize:10},!0)}]),app.controller("setUpC",["$scope","$http","$location","$rootScope",function(s,e,t,a){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/messageType/deleteMessageType"==e.url&&(s.isDelete=e.checked),"/web/api/manage/messageType/getMessageTypeList"==e.url&&(s.isList=e.checked),"/web/api/manage/messageType/saveMessageType"==e.url&&(s.isSave=e.checked)}),s.form={typeName:"",description:""},s.dialogStyle={display:"none"},s.initLaypage=function(t,a){s.total=t,s.pageSize=a,layui.use("laypage",function(){var e=layui.laypage;e.render({elem:"setUpAPage",count:t,limit:a,layout:["count","prev","page","next","skip","limit"],jump:function(e,t){t||(s.pageSize=e.limit,s.pageNum=e.curr,s.getListData({pageNum:e.curr,pageSize:e.limit}))}}),e.render({elem:"setUpBPage",count:s.total,layout:["count","prev","page","next","skip","limit"],jump:function(e,t){t||(s.pageNum=e.curr,s.pageSize=e.limit,s.getListData(e.curr,e.limit))}})})},s.getInfoData=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageType_getMessageTypeList,data:{id:s.form.id},async:!0,dataType:"json",success:function(e){s.form=e.data[0],s.$apply()},error:function(e){console.log(e)}})},s.dialog=function(e,t){s.form.id=t,"edit"==(s.fun=e)?(s.dialogStyle={zIndex:19891015,width:"600px",height:"300px",top:"30%",left:"50%",marginLeft:"-200px"},s.getInfoData()):s.dialogStyle="add"==e?{zIndex:19891015,width:"600px",height:"300px",top:"30%",left:"50%",marginLeft:"-200px"}:{zIndex:19891015,width:"300px",height:"150px",top:"30%",left:"50%",marginLeft:"-200px"},$(".layui-layer-shade").show(),$(".layui-layer").show()},s.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide(),s.form={typeName:"",description:""}},s.Verification=function(){if("edit"==s.fun||"add"==s.fun){if(""==s.form.typeName)return alert("请输入名称！"),!1;if(""==s.form.description||512<s.form.description.length)return alert("请输入长度不超过512的文本描述！"),!1}s.save()},s.save=function(){var e="",t="";t="add"==s.fun?(e=apiConfig.manage_messageType_saveMessageType,{typeName:s.form.typeName,description:s.form.description}):"edit"==s.fun?(e=apiConfig.manage_messageType_saveMessageType,{id:s.form.id,typeName:s.form.typeName,description:s.form.description}):(e=apiConfig.manage_messageType_deleteMessageType,{id:s.form.id}),s.submit(e,t)},s.submit=function(e,t){$.ajax({type:"post",url:config.webAPI.address+e,data:_extends({},t),async:!0,dataType:"json",success:function(e){e.success?(alert("删除成功！"),s.close(),s.getListData({pageNum:s.pageNum,pageSize:10},!1)):alert(e.message)},error:function(e){console.log(e)}})},s.getListData=function(a,i){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_messageType_getMessageTypeList,data:_extends({},s.filter,a),async:!0,dataType:"json",success:function(e){s.listData=e.data;for(var t=1;t<=s.listData.length;t++)s.listData[t-1].no=t;s.total=e.total,s.$apply(),i&&s.initLaypage(e.total,a.pageSize)},error:function(e){console.log(e)}})},s.getListData({pageNum:1,pageSize:10},!0)}]);
"use strict";app.controller("faultListC",["$scope","$timeout","$http","$location","$rootScope",function(o,e,a,t,r){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/breakdowns/getDeviceCurrentErrorList"==e.url&&(o.isList=e.checked),"/web/api/manage/breakdown/deleteDeviceError"==e.url&&(o.isDelete=e.checked)}),o.productList=JSON.parse(sessionStorage.getItem("productNameList")),o.errorList=[],o.filter={identityId:"",deviceName:"",productKey:"",errorCode:"",status:"",startTime:"",endTime:"",productModel:"",snCode:""},layui.use(["form","layedit","laydate"],function(){layui.form,layui.layer,layui.layedit;layui.laydate.render({elem:"#date",type:"datetime",range:!0,done:function(e,a,t){e.length<1?(o.filter.startTime="",o.filter.endTime=""):(o.filter.startTime=e.slice(0,20),o.filter.endTime=e.slice(22))}})}),o.goHistory=function(){t.path("/faultLog/"+Math.random())},o.getErrorName=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.common_getErrorName_list,data:{},async:!0,dataType:"json",success:function(e){o.errorList=e.data},error:function(e){console.log(e)}})},o.initPage=function(e,a){o.total=e,o.pageSize=a,layui.use("laypage",function(){layui.laypage.render({elem:"faultListPage",count:e,limit:a,layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(o.pageNum=e.curr,o.pageSize=e.limit,o.getListData({pageNum:e.curr,pageSize:e.limit}))}})})},o.dialog=function(e,a){o.deleteId=e,o.deleteName=a,$(".layui-layer-shade").show(),$(".delete").show()},o.close=function(e){$(".layui-layer-shade").hide(),$(".layui-layer").hide()},o.delete=function(){$.ajax({type:"post",url:config.webAPI.address+apiConfig.manage_breakdown_deleteDeviceError,data:{id:o.deleteId},async:!0,dataType:"json",success:function(e){e.success?(o.close(),alert("删除成功！"),o.getListData({pageNum:1,pageSize:10},!0)):alert(e.message)},error:function(e){console.log(e)}})},o.getListData=function(t,r){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_breakdowns_getDeviceCurrentErrorList,data:_extends({},o.filter,t),async:!0,dataType:"json",success:function(e){for(var a in o.total=e.total,o.listData=e.data,o.listData)o.listData[a].no=Number(a)+1+10*(Number(t.pageNum)-1),null!=o.listData[a].phone&&(o.listData[a].phone=dealPhone(o.listData[a].phone));r&&o.initPage(o.total,t.pageSize),o.$apply()},error:function(e){console.log(e)}})},o.getListData({pageNum:1,pageSize:10},!0),o.getErrorName()}]),app.controller("faultDetailsC",["$scope","$http","$location","$routeParams",function(t,e,a,r){t.id=r.id,t.deviceId=r.deviceId,t.getInfoData=function(e,a){dataRequest("get",apiConfig.manage_breakdowns_getBreakdownAndDealInfo,{errorId:t.id,deviceId:t.deviceId},function(e){t.faultInfo=e.data}),dataRequest("get","manage/breakdown/getBreakdownList",{errorId:t.id},function(e){t.faultInfos=e.data.list[0]}),dataRequest("get",apiConfig.manage_device_detail,{id:t.deviceId},function(e){t.deviceDetail=e.data.deviceDetail,t.filter=e.data.filter,t.$apply()})},t.getInfoData()}]),app.controller("faultTrendC",["$scope","$http","$location","$rootScope",function(o,e,a,t){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/breakdowns/getDeviceCurrentErrorTrent"==e.url&&(o.isDetail=e.checked)}),o.total=0,o.filter={timeType:1},o.count={repairErrorCount:"",newErrorCount:""},o.initLaypage=function(e,a){o.total=e,o.pageSize=a,layui.use("laypage",function(){layui.laypage.render({elem:"faultTrendPage",count:o.total,limit:Number(a),layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(o.pageNum=e.curr,o.pageSize=e.limit,o.getListData({pageNum:e.curr,pageSize:e.limit}))}})})},o.close=function(e){$(".layui-layer-shade").hide(),$(".layui-layer").hide()},o.changeTab=function(e){o.filter.status=e,o.getListData({pageNum:1,pageSize:10},!0)},o.changeDayTab=function(e){o.filter.timeType=e,o.getCountByTime(e),o.getListData({pageNum:1,pageSize:10},!0)},o.getCountByTime=function(e){$.ajax({type:"post",url:config.webAPI.address+apiConfig.manage_breakdowns_getDeviceCurrentErrorCount,data:{timeType:e},async:!0,dataType:"json",success:function(e){o.count=e.data,o.$apply()},error:function(e){console.log(e)}})},o.getListData=function(t,r){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_breakdowns_getDeviceCurrentErrorTrent,data:_extends({},o.filter,t),async:!0,dataType:"json",success:function(e){for(var a in o.listData=e.data,o.total=e.total,o.listData)null!=o.listData[a].phone&&(o.listData[a].phone=dealPhone(o.listData[a].phone));o.$apply(),r&&o.initLaypage(o.total,t.pageSize)},error:function(e){console.log(e)}})},o.getListData({pageNum:1,pageSize:10},!0),o.getCountByTime(1)}]),app.controller("faultSetUpC",["$scope","$http","$location","$rootScope",function(o,e,a,t){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/breakdown/createBreakdown"==e.url&&(o.isAdd=e.checked),"/web/api/manage/breakdown/updateBreakdown"==e.url&&(o.isUpdate=e.checked),"/web/api/manage/breakdown/deleteBreakdown"==e.url&&(o.isDelete=e.checked),"/web/api/manage/breakdown/getBreakdownList"==e.url&&(o.isList=e.checked),"/web/api/manage/breakdown/updatePretreatment"==e.url&&(o.isUpdatePretreatment=e.checked)}),o.rankList=[9,8,7,6,5,4,3,2,1],o.form={id:"",errorId:"",rank:"",errorName:""},o.dialog_tips={fontSize:"12px",color:"#999999"},o.dialogStyle={display:"none"},o.filter={errorName:""},o.verification=function(){return/[\u4e00-\u9fa5]/.test(o.form.errorName)&&""!=o.form.errorName?!/^[0-9a-zA-Z]+$/.test(o.form.errorId)||""==o.form.errorId||64<o.form.errorId.length?(alert("故障ID不能为空且必须为长度64位以内大小写英文数字！"),!1):!(10<Number(o.form.rank)||""==o.form.rank)||(alert("故障登记不能为空且必须为长度2位纯数字！"),!1):(alert("故障名称不能为空且必须为中文！"),!1)},o.resetForm=function(){o.form={errorId:"",rank:"1",errorName:""}},o.dialog=function(e,a,t,r){o.deleteName=t,o.form.errorId=a,o.form.rank="",o.form.id=r,o.dialogTitle=e,o.enable=a,"edit"==o.dialogTitle||"add"==o.dialogTitle?("edit"==o.dialogTitle&&o.getSetUpInfo(a),o.dialogStyle={zIndex:"19891015",width:"500px",height:"350px",top:"20%",left:"50%",marginLeft:"-250px"}):o.dialogStyle={zIndex:"19891015",width:"400px",height:"150px",top:"30%",left:"50%",marginLeft:"-150px"},$(".layui-layer-shade").show(),$(".layui-layer").show()},o.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide(),o.resetForm()},o.save=function(){var e={},a="",t="";if(("edit"==o.dialogTitle||"add"==o.dialogTitle)&&!o.verification())return!1;"edit"==o.dialogTitle&&(e={id:o.form.id,errorId:o.form.errorId,rank:o.form.rank,errorName:o.form.errorName},a="post",t=apiConfig.manage_breakdown_updateBreakdown),"add"==o.dialogTitle&&(e={errorId:o.form.errorId,rank:o.form.rank,errorName:o.form.errorName},a="post",t=apiConfig.manage_breakdown_createBreakdown),"staus"==o.dialogTitle&&(e={id:o.form.id,enable:o.form.errorId},a="post",t=apiConfig.manage_breakdown_forbidden),"delete"==o.dialogTitle&&(t=apiConfig.manage_breakdown_deleteBreakdown,a="post",e={errorId:o.form.errorId}),$.ajax({type:a,url:config.webAPI.address+t,data:_extends({},e),async:!0,dataType:"json",success:function(e){o.close(),e.success?alert("成功!"):alert(e.message),o.getListData({pageSize:o.pageSize,pageNum:o.pageNum})},error:function(e){return!1}})},o.scheme=function(e){a.path("/faultScheme/"+e)},o.getListData=function(t,r){o.pageSize=t.pageSize,o.pageNum=t.pageNum,o.listData=[],o.total=0;var e=apiConfig.manage_breakdown_getBreakdownList,a=_extends({errorName:o.filter.errorName,errorId:o.filter.errorId,rank:o.filter.rank},t);$.ajax({type:"get",url:config.webAPI.address+e,data:a,async:!0,dataType:"json",success:function(e){o.listData=e.data.list;for(var a=0;a<o.listData.length;a++)o.listData[a].no=a,o.listData[a].errorId=parseInt(o.listData[a].errorId);o.total=e.data.total,o.$apply(),r&&o.initLaypage(o.total,t.pageSize)},error:function(e){return!1}})},o.getSetUpInfo=function(e){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_breakdown_getBreakdownList,data:{errorId:e},async:!0,dataType:"json",success:function(e){o.form=e.data.list[0],o.form.rank=o.form.rank.toString(),o.$apply()},error:function(e){console.log(e)}})},o.initLaypage=function(e,a){layui.use("laypage",function(){layui.laypage.render({elem:"faultSetUpPage",count:e,limit:Number(a),layout:["count","prev","page","next","skip","limit"],jump:function(e,a){o.pageSize=e.limit,o.pageNum=e.curr,a||o.getListData({pageSize:e.limit,pageNum:e.curr})}})})},o.handleSearch=function(){var e={pageSize:o.pageSize,pageNum:o.pageNum};o.getListData(e)},o.resetForm(),o.getListData({pageSize:10,pageNum:1},!0)}]),app.controller("faultSchemeC",["$scope","$http","$location","$rootScope",function(o,e,a,t){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/breakdown/updatePretreatment"==e.url&&(o.isUpdatePretreatment=e.checked),"/web/api/manage/breakdown/createPretreatment"==e.url&&(o.isCreatePretreatment=e.checked),"/web/api/manage/breakdown/getPretreatmentList"==e.url&&(o.isGetPretreatmentList=e.checked),"/web/api/manage/breakdown/deletePretreatment"==e.url&&(o.isdeletePretreatment=e.checked)}),o.btnNormal=["layui-btn","layui-btn-sm","layui-btn-normal"],o.btnDanger=["layui-btn","layui-btn-sm","layui-btn-danger"],o.btnDisable=["layui-btn","layui-btn-sm","layui-btn-disabled"],o.productList=[],o.errorId=a.$$path.slice(13),o.total=0,o.dialogStyle={display:"none"},o.filter={productkey:""},o.form={productKey:"",phoneNum:"",resolution:"",errorId:o.errorId},o.getInfoData=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.manage_breakdown_getBreakdownList,data:{errorId:o.errorId},async:!0,dataType:"json",success:function(e){o.infoData={errorId:e.data.list[0].errorId,errorName:e.data.list[0].errorName,rank:e.data.list[0].rank},o.$apply()},error:function(e){console.log(e)}})},o.getProductList=function(){$.ajax({type:"get",url:config.webAPI.address+apiConfig.common_getProductName_list,data:{},async:!0,dataType:"json",success:function(e){o.productList=e.data,o.$apply()},error:function(e){console.log(e)}})},o.verification=function(e){return""==o.form.productKey?(alert("产品名称为必选！"),!1):""==o.form.phoneNum?(alert("请输入联系方式！"),!1):""!=o.form.resolution||(alert("请填写预处理方案！"),!1)},o.initLaypage=function(e,a){o.total=e,o.pageSize=a,layui.use("laypage",function(){layui.laypage.render({elem:"faultSchemePage",count:e,limit:a,layout:["count","prev","page","next","skip","limit"],jump:function(e,a){a||(o.pageNum=e.curr,o.pageSize=e.limit,o.getListData({pageNum:e.curr,pageSize:e.limit}))}})})},o.getListData=function(a,t){var e=apiConfig.manage_breakdown_getPretreatmentList;$.ajax({type:"get",url:config.webAPI.address+e,data:_extends({errorId:o.errorId},o.filter,a),async:!0,dataType:"json",success:function(e){o.listData=e.data.list,o.total=e.data.total,o.$apply(),t&&o.initLaypage(o.total,a.pageSize)},error:function(e){console.log(e)}})},o.handleSearch=function(e){var a={pageNum:1,pageSize:10,errorId:o.errorId,productName:o.filter.productName};o.getListData(a)},o.dialog=function(e,a,t,r){o.productName=t,o.productKey=a,"edit"==(o.dialogTitle=e)&&o.getEditData({productKey:a}),"add"==e||"edit"==e?(i.txt.html(""),o.dialogStyle={zIndex:"19891015",width:"800px",height:"550px",top:"10%",left:"50%",marginLeft:"-400px"},o.id=r):"info"==e?(o.dialogStyle={zIndex:"19891015",width:"320px",backgroundImage:"url(../../images/phone.png)",backgroundRepeat:"no-repeat",backgroundPositionY:"15px",backgroundSize:"100% 100%",height:"550px",top:"51%",left:"50%",marginLeft:"-160px",marginTop:"-275px"},o.resolution=r):(o.dialogStyle={zIndex:"19891015",width:"300px",height:"150px",top:"20%",left:"50%",marginLeft:"-200px"},o.id=r),o.form={resolution:"",phoneNum:"",productKey:"",errorId:o.errorId},$(".layui-layer-shade").show(),$(".layui-layer").show()},o.close=function(){$(".layui-layer-shade").hide(),$(".layui-layer").hide(),o.form={resolution:"",phoneNum:"",productKey:"",errorId:o.errorId}},o.save=function(){if("add"==o.dialogTitle){if(o.form.resolution=i.txt.html(),o.verification(o.form)){var e=apiConfig.manage_breakdown_createPretreatment,a=_extends({},o.form),t="post";o.submit(e,t,a)}}else if("edit"==o.dialogTitle){if(o.form.resolution=i.txt.html(),o.verification(o.form)){e=apiConfig.manage_breakdown_updatePretreatment,a=_extends({id:o.id},o.form),t="post";o.submit(e,t,a)}}else if("stop"==o.dialogTitle){e=apiConfig.manage_breakdown_updatePretreatment,a={errorId:o.errorId,id:o.id,productKey:o.productKey,status:0},t="post";o.submit(e,t,a)}else if("start"==o.dialogTitle){e=apiConfig.manage_breakdown_updatePretreatment,a={productKey:o.productKey,errorId:o.errorId,id:o.id,status:1},t="post";o.submit(e,t,a)}else{e=apiConfig.manage_breakdown_deletePretreatment,a={productKey:o.productKey,errorId:o.errorId,id:o.id,status:1},t="post";o.submit(e,t,a)}},o.getEditData=function(e){var a=apiConfig.manage_breakdown_getPretreatmentList;$.ajax({type:"get",url:config.webAPI.address+a,data:_extends({errorId:o.errorId},e),async:!0,dataType:"json",success:function(e){o.form={productKey:e.data.list[0].productKey,phoneNum:e.data.list[0].phoneNum,resolution:e.data.list[0].resolution,errorId:o.errorId},i.txt.html(e.data.list[0].resolution),o.$apply()},error:function(e){console.log(e)}})},o.submit=function(e,a,t){$.ajax({type:a,url:config.webAPI.address+e,data:t,async:!0,dataType:"json",success:function(e){e.success?(alert("成功!"),o.getListData({pageNum:o.pageNum,pageSize:o.pageSize},!1)):alert(e.message),o.close(),o.getListData({pageNum:o.pageNum,pageSize:o.pageSize},!0)},error:function(e){console.log(e)}})},o.getListData({pageNum:1,pageSize:10},!0),o.getProductList(),o.getInfoData();var i=new window.wangEditor("#editor");i.create()}]),app.controller("faultRepairC",["$scope","$http","$location","$rootScope","$routeParams",function(s,e,a,t,r){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/breakdowns/getBreakdownDealList"==e.url&&(s.isList=e.checked)}),dataRequest("get","manage/customer/query/getCsmStatus",{dealType:"2"},function(e){console.log(e)}),s.breakdownList=function(e,a,t,r,o,i,n,d){dataRequest("GET","manage/breakdowns/getBreakdownDealList",{pageNum:e,pageSize:a,deviceName:r,userPhone:o,appealId:i,reportType:n,dealType:d},function(e){s.breakList=e.data,s.$apply(),t&&pageUtils(e.total,"repairAll",function(e){s.breakdownList(e.curr,e.limit,!1,s.deviceName,s.userPhone,s.appealId,s.reportType,2)})})},s.breakdownList(1,10,!0,s.deviceName,s.userPhone,s.appealId,s.reportType,2),s.search=function(){s.breakdownList(1,10,!0,s.deviceName,s.userPhone,s.appealId,s.reportType,2)}}]),app.controller("faultMaintainC",["$scope","$http","$location","$rootScope","$routeParams",function(s,e,a,t,r){JSON.parse(sessionStorage.getItem("permission")).forEach(function(e){"/web/api/manage/breakdowns/getBreakdownDealList"==e.url&&(s.isList=e.checked)}),dataRequest("get","manage/customer/query/getCsmStatus",{dealType:"3"},function(e){console.log(e)}),s.breakdownList=function(e,a,t,r,o,i,n,d){dataRequest("GET","manage/breakdowns/getBreakdownDealList",{pageNum:e,pageSize:a,deviceName:r,userPhone:o,appealId:i,reportType:n,dealType:d},function(e){s.breakList=e.data,s.$apply(),t&&pageUtils(e.total,"repairAll",function(e){s.breakdownList(e.curr,e.limit,!1,s.deviceName,s.userPhone,s.appealId,s.reportType,3)})})},s.breakdownList(1,10,!0,s.deviceName,s.userPhone,s.appealId,s.reportType,3),s.search=function(){s.breakdownList(1,10,!0,s.deviceName,s.userPhone,s.appealId,s.reportType,3)}}]);
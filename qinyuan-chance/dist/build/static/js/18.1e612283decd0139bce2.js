webpackJsonp([18],{pzfS:function(n,e,t){(n.exports=t("UTlt")(!0)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","",{version:3,sources:[],names:[],mappings:"",file:"roleInfo.vue",sourceRoot:""}])},qeXC:function(n,e,t){var i=t("pzfS");"string"==typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);t("FIqI")("aeecc5aa",i,!1,{})},vKjr:function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("3cXf"),a=t.n(i),r=t("B0rZ"),o={name:"roleInfo",data:function(){return{permission:{edit:!1},menu:r.a,pageNum:1,pageSize:10,dialogTitle:"",total:0,act:"",roleId:"",dialog:!1,pageLoaidng:!1,formLoading:!0,filter:{roleName:""},rule:{roleName:{required:!0,message:"角色名称不能为空",trigger:"blur"}},form:{roleName:"",roleFlag:1,permissions:[]},permissions:[],rolelistData:[],columns:[{title:"角色名称",key:"roleName"},{title:"创建人",key:"createBy"},{title:"创建时间",key:"createTime"}]}},mounted:function(){this.$route.query.roleId?(this.roleId=this.$route.query.roleId,this.getInfo(),this.getPermissionList()):this.$router.push({path:"/system/roleList",name:"roleList"})},methods:{getInfo:function(){var n=this;this.pageLoaidng=!0;var e=this.$api.manage_role_detail,t={roleId:this.roleId};this.$Ax.get(e,{params:t}).then(function(e){n.permissions=n.handleDealTree(e.data.data.permissions),n.rolelistData=[],n.rolelistData.push({roleName:e.data.data.roleName,createBy:e.data.data.createBy,createTime:e.data.data.createTime}),n.pageLoaidng=!1}).catch(function(n){console.log(n)})},handleEdit:function(){var n=this;this.cancel(),this.act="edit";var e={roleId:this.roleId},t=this.$api.manage_role_detail;this.$Ax.get(t,{params:e}).then(function(e){n.form=e.data.data,n.dialogTitle="角色编辑",n.dialog=!0}).catch(function(n){console.log(n)})},handleEditPermission:function(){var n=this;this.cancel(),this.act="permission";var e={roleId:this.roleId},t=this.$api.manage_role_detail;this.$Ax.get(t,{params:e}).then(function(e){n.form=e.data.data,n.dialogTitle="权限编辑",n.dialog=!0}).catch(function(n){console.log(n)})},handleDealTree:function(n){var e=!1,t=[];for(var i in n)if(e=!0,n[i].checked)for(var a in n[i].children)if(n[i].children[a].checked){for(var r in t=[],n[i].children[a].children)n[i].children[a].children[r].checked||t.push(r);for(var o in t)delete n[i].children[a].children[o]}else delete n[i].children[a].children;else delete n[i].children;if(e)return n},submit:function(){var n=this,e=this.$api.manage_role_update,t=this.handleGetTree(this.$refs.tree.getCheckedNodes());if(0==t.length)return this.$Message.error("请至少选择一个权限"),this.changeLoading();var i={id:this.roleId,roleName:this.form.roleName,roleFlag:this.form.roleFlag,permissions:a()(t)};this.$refs.form.validate(function(t){if(!t)return n.changeLoading();n.$Ax.post(e,i).then(function(e){e.data.success&&(n.$Message.success("编辑角色成功！"),n.getInfo(),n.dialog=!1)}).catch(function(n){console.log(n)}),setTimeout(function(){n.changeLoading()},1e3)})},handleGetTree:function(n){var e=[],t=this.menu;for(var i in t)if(t[i].checked)e.push(t[i]);else if(t[i].indeterminate){var a={name:t[i].name,title:t[i].title,path:t[i].path,checked:!0,children:[]};for(var r in t[i].children)if(t[i].children[r].checked)a.children.push(t[i].children[r]);else if(t[i].children[r].indeterminate){var o={name:t[i].children[r].name,title:t[i].children[r].title,path:t[i].children[r].path,checked:!0,children:[]};for(var l in t[i].children[r].children)if(t[i].children[r].children[l].checked){var s={name:t[i].children[r].children[l].name,title:t[i].children[r].children[l].title,checked:!0};o.children.push(s)}a.children.push(o)}e.push(a)}return e},cancel:function(){this.$refs.form.resetFields(),this.clearTree(this.menu)},clearTree:function(n){for(var e in n)for(var t in n[e].checked=!1,delete n[e].indeterminate,n[e].children)for(var i in n[e].children[t].checked=!1,delete n[e].children[t].indeterminate,n[e].children[t].children)n[e].children[t].children[i].checked=!1,delete n[e].children[t].children[i].indeterminate;return n},changeLoading:function(){var n=this;this.formLoading=!1,this.$nextTick(function(){n.formLoading=!0})},getPermissionList:function(){var n=JSON.parse(sessionStorage.getItem("menu"));for(var e in n)if("系统管理"==n[e].name)for(var t in n[e].children)if("角色列表"==n[e].children[t].name){var i=n[e].children[t].children;for(var a in i)"角色编辑"==i[a].name&&(this.permission.edit=i[a].checked)}}}},l=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"clearfloat",attrs:{id:"roleInfo"}},[t("Tabs",{attrs:{type:"card"}},[t("TabPane",{attrs:{label:"基本信息"}},[t("Table",{attrs:{columns:n.columns,data:n.rolelistData,border:""}}),n._v(" "),n.permission.edit?t("Button",{staticClass:"left marginTop",attrs:{type:"primary"},on:{click:n.handleEdit}},[n._v("编辑")]):n._e()],1),n._v(" "),t("TabPane",{attrs:{label:"权限信息"}},[t("Tree",{attrs:{data:n.permissions,"empty-text":"暂无数据"}}),n._v(" "),n.permission.edit?t("Button",{staticClass:"left marginTop",attrs:{type:"primary"},on:{click:n.handleEditPermission}},[n._v("编辑")]):n._e()],1)],1),n._v(" "),n.pageLoaidng?t("Spin",{attrs:{fix:""}}):n._e(),n._v(" "),t("Modal",{attrs:{title:n.dialogTitle,loading:n.formLoading},on:{"on-ok":n.submit,"on-cancel":n.cancel},model:{value:n.dialog,callback:function(e){n.dialog=e},expression:"dialog"}},[t("Form",{ref:"form",attrs:{model:n.form,rules:n.rule,"label-position":"right","label-width":120}},[t("FormItem",{directives:[{name:"show",rawName:"v-show",value:"edit"==n.act,expression:'act=="edit"'}],attrs:{prop:"roleName",label:"角色名称:"}},[t("Input",{staticClass:"input",model:{value:n.form.roleName,callback:function(e){n.$set(n.form,"roleName",e)},expression:"form.roleName"}})],1),n._v(" "),t("FormItem",{directives:[{name:"show",rawName:"v-show",value:"edit"==n.act,expression:'act=="edit"'}],attrs:{prop:"roleFlag",label:"角色类型(是否全局):"}},[t("Select",{staticClass:"input",model:{value:n.form.roleFlag,callback:function(e){n.$set(n.form,"roleFlag",e)},expression:"form.roleFlag"}},[t("Option",{attrs:{value:"1"}},[n._v("是")]),n._v(" "),t("Option",{attrs:{value:"0"}},[n._v("否")])],1)],1),n._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"permission"==n.act,expression:'act=="permission"'}]},[t("Tree",{ref:"tree",staticStyle:{"margin-left":"70px"},attrs:{data:n.menu,"empty-text":"暂无数据","show-checkbox":""}})],1)],1)],1)],1)};l._withStripped=!0;var s={render:l,staticRenderFns:[]},c=s;var d=!1;var h=t("C7Lr")(o,c,!1,function(n){d||t("qeXC")},"data-v-2b1600fa",null);h.options.__file="src/views/system/roleInfo.vue";e.default=h.exports}});
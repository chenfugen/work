webpackJsonp([20],{KsIq:function(t,e,a){var i=a("gNr6");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("FIqI")("3950defc",i,!1,{})},gNr6:function(t,e,a){(t.exports=a("UTlt")(!0)).push([t.i,"\n.actBox[data-v-1fdb2943] {\n\tmargin-bottom: 20px;\n}\n.model_value[data-v-1fdb2943] {\n\ttext-align: center;\n}\n.txt[data-v-1fdb2943] {\n\twidth: 40%;\n\tmargin: 0 auto;\n\tmargin-top: 20px;\n\ttext-align: left;\n}\n.demo-table-error-row td[data-v-1fdb2943] {\n\tbackground-color: #ff6600;\n\tcolor: #fff;\n}\n","",{version:3,sources:["/Users/nelson/workspace/qinyuan-chance-farm-web/static-files/src/views/key/keyList.vue"],names:[],mappings:";AACA;CACC,oBAAoB;CACpB;AACD;CACC,mBAAmB;CACnB;AACD;CACC,WAAW;CACX,eAAe;CACf,iBAAiB;CACjB,iBAAiB;CACjB;AACD;CACC,0BAA0B;CAC1B,YAAY;CACZ",file:"keyList.vue",sourcesContent:["\n.actBox[data-v-1fdb2943] {\n\tmargin-bottom: 20px;\n}\n.model_value[data-v-1fdb2943] {\n\ttext-align: center;\n}\n.txt[data-v-1fdb2943] {\n\twidth: 40%;\n\tmargin: 0 auto;\n\tmargin-top: 20px;\n\ttext-align: left;\n}\n.demo-table-error-row td[data-v-1fdb2943] {\n\tbackground-color: #ff6600;\n\tcolor: #fff;\n}\n"],sourceRoot:""}])},w2Yi:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,o=a("a3Yh"),n=a.n(o),r=a("4YfN"),s=a.n(r),l={name:"keyList",data:function(){var t=this;return{permission:{add:!1,set:!1,info:!1},editTxt:"修改",pageNum:1,pageSize:10,total:0,dialog:!1,showEdit:!1,tableLoading:!1,selectALoading:!1,productLoading:!1,modalLoading:!1,formLoading:!0,act:"",filter:{productKey:""},form:{productKey:"",productName:"",productSecret:"",warnCount:0},rule:{productKey:[{required:!0,message:"请选择产品",trigger:"blur"}],warnCount:[{type:"integer",required:!0,message:"请输入阀值",trigger:"blur"}]},productList:[],productAbleList:[],listData:[],columns:[{title:"产品名称",key:"productName",align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"text",size:"small",disabled:!t.permission.info},style:{color:"#0000FF"},on:{click:function(){t.goInfo(a.row,"0")}}},a.row.productName)])}},{title:"ProductKey",align:"center",key:"productKey"},{title:"ProductSecret",align:"center",key:"productSecret"},{title:"剩余量",key:"address",width:80,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"text",size:"small",disabled:!t.permission.info},style:{color:"#0000FF"},on:{click:function(){t.goInfo(a.row,"0")}}},a.row.leftCount)])}},{title:"使用量",key:"address",width:80,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"text",size:"small",disabled:!t.permission.info},style:{color:"#0000FF"},on:{click:function(){t.goInfo(a.row,"1")}}},a.row.usedCount)])}},{title:"总量",key:"address",width:80,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"text",size:"small",disabled:!t.permission.info},style:{color:"#0000FF"},on:{click:function(){t.goInfo(a.row,"0")}}},a.row.totalCount)])}},{title:"操作",key:"action",width:150,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small",disabled:!t.permission.set},on:{click:function(){t.handleSetUp(a.row)}}},"预警设置")])}}]}},mounted:function(){this.getPermissionList(),this.getListData(),this.getProductList()},methods:(i={getListData:function(){var t=this;this.tableLoading=!0;var e=this.$api.manage_triplesConfig_getTriplesConfigList,a=s()({pageNum:this.pageNum,pageSize:this.pageSize},this.filter);this.$Ax.get(e,{params:a}).then(function(e){t.listData=e.data.data,t.total=e.data.total,t.tableLoading=!1}).catch(function(t){console.log(t)})},flip:function(t){this.pageNum=t,this.getListData()},rowClassName:function(t,e){var a=Number(null==t.warnCount?0:t.warnCount),i=Number(null==t.leftCount?0:t.leftCount);return Number(a)>=Number(i)?"demo-table-error-row":""},handleChangePageSize:function(t){this.pageSize=t,this.getListData()}},n()(i,"handleChangePageSize",function(){}),n()(i,"getProductList",function(){var t=this;this.selectALoading=!0;var e=this.$api.manage_product_list;this.$Ax.get(e,{params:{pageNum:1,pageSize:100}}).then(function(e){t.productList=e.data.data,t.selectALoading=!1}).catch(function(t){console.log(t)})}),n()(i,"getProductAbleList",function(){var t=this;this.selectALoading=!0;var e=this.$api.manage_product_list;this.$Ax.get(e,{params:{status:1,pageNum:1,pageSize:1e4}}).then(function(e){t.productAbleList=e.data.data}).catch(function(t){console.log(t)})}),n()(i,"handleSetUp",function(t){var e=this;this.act="edit",this.modalLoading=!0,this.editTxt="修改",this.showEdit=!1;var a=this.$api.manage_triplesConfig_getTriplesConfigInfo,i={id:t.id};this.dialog=!0,this.$Ax.get(a,{params:i}).then(function(t){e.form=t.data.data,e.modalLoading=!1}).catch(function(t){console.log(t)})}),n()(i,"handleEdit",function(){var t=this;if(this.showEdit){var e=this.$api.manage_triplesConfig_saveFirmwareTriplesConfig,a=this.form;this.$Ax.post(e,a).then(function(e){e.data.success&&(t.$Message.success(e.data.data),t.dialog=!1)}).catch(function(t){console.log(t)})}else this.showEdit=!0,this.editTxt="确认"}),n()(i,"handleAdd",function(){this.getProductAbleList(),this.act="add",this.dialog=!0}),n()(i,"goInfo",function(t,e){this.$router.push({path:"/key/keyInfo",name:"keyInfo",query:{id:t.id,status:e,productKey:t.productKey,productSecret:t.productSecret}})}),n()(i,"submit",function(){var t=this;if("add"==this.act){var e=this.$api.manage_triplesConfig_saveFirmwareTriplesConfig,a={productKey:this.form.productKey,warnCount:this.form.warnCount};this.$refs.form.validate(function(i){if(!i)return t.changeLoading();t.$Ax.post(e,a).then(function(e){e.data.success&&(t.$Message.success(e.data.data),t.getListData(),t.dialog=!1)}).catch(function(t){console.log(t)}),setTimeout(function(){t.changeLoading()},1e3)})}else this.dialog=!1,this.getListData()}),n()(i,"changeLoading",function(){var t=this;this.formLoading=!1,this.$nextTick(function(){t.formLoading=!0})}),n()(i,"cancel",function(){this.$refs.form.resetFields()}),n()(i,"dealNull",function(t){return""===t||null===t?"--":t}),n()(i,"getPermissionList",function(){var t=JSON.parse(sessionStorage.getItem("menu"));for(var e in t)if("秘钥管理"==t[e].name){var a=t[e].children[0].children;for(var i in a)"预警设置"==a[i].name&&(this.permission.set=a[i].checked),"秘钥详情"==a[i].name&&(this.permission.info=a[i].checked),"秘钥添加"==a[i].name&&(this.permission.add=a[i].checked)}}),i)},c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"keyList"}},[a("div",{staticClass:"actBox clearfloat"},[a("Button",{staticClass:"left",attrs:{type:"primary"},on:{click:t.getListData}},[t._v("查询")]),t._v(" "),t.permission.add?a("Button",{staticClass:"right",attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("添加")]):t._e()],1),t._v(" "),a("Form",{ref:"filter",staticClass:"clearfloat",attrs:{model:t.filter,"label-width":0}},[a("FormItem",{staticClass:"input left marginRight",attrs:{prop:"productName"}},[a("Select",{staticClass:"input marginRight",attrs:{loading:t.productLoading,placeholder:"产品名称",clearable:""},model:{value:t.filter.productKey,callback:function(e){t.$set(t.filter,"productKey",e)},expression:"filter.productKey"}},t._l(t.productList,function(e){return a("Option",{key:e.productKey,attrs:{value:e.productKey}},[t._v(t._s(t.dealNull(e.name)))])}))],1)],1),t._v(" "),a("div",{staticClass:"table clearfloat marginTop"},[a("Table",{attrs:{loading:t.tableLoading,"row-class-name":t.rowClassName,columns:t.columns,data:t.listData,border:""}}),t._v(" "),a("Page",{staticClass:"right marginTop",attrs:{current:t.pageNum,total:t.total,"page-size":t.pageSize,size:"small","page-size-opts":[10,20,30,40],"show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":t.flip,"on-page-size-change":t.handleChangePageSize}})],1),t._v(" "),a("Modal",{staticStyle:{position:"relative"},attrs:{loading:t.formLoading,title:"预警设置",width:"60"},on:{"on-ok":t.submit,"on-cancel":t.cancel},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:"edit"==t.act,expression:'act=="edit"'}]},[a("Form",{ref:"forms",attrs:{model:t.form,rules:t.rule,"label-position":"right","label-width":120,inline:""}},[a("FormItem",{staticStyle:{width:"45%"},attrs:{label:"产品名称:"}},[a("span",[t._v(t._s(t.dealNull(t.form.productName)))])]),t._v(" "),a("FormItem",{staticStyle:{width:"45%"},attrs:{label:"ProductName:"}},[a("span",[t._v(t._s(t.dealNull(t.form.productName)))])]),t._v(" "),a("FormItem",{staticStyle:{width:"45%"},attrs:{label:"ProductSecret:"}},[a("span",[t._v(t._s(t.dealNull(t.form.productSecret)))])])],1),t._v(" "),a("span",[t._v("当前预警阀值")]),t._v(" "),a("Divider"),t._v(" "),a("div",{staticClass:"model_value"},[t.showEdit?a("InputNumber",{staticClass:"input",staticStyle:{"font-size":"25px",margin:"0 auto","margin-bottom":"20px",display:"block"},attrs:{size:"large",placeholder:"请输入阀值",precision:0},model:{value:t.form.warnCount,callback:function(e){t.$set(t.form,"warnCount",e)},expression:"form.warnCount"}}):a("span",{staticStyle:{"font-size":"40px",display:"block"}},[t._v(t._s(t.dealNull(t.form.warnCount)))]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.handleEdit}},[t._v(t._s(t.editTxt))]),t._v(" "),t.showEdit?a("Button",{attrs:{type:"primary"},on:{click:function(e){t.handleSetUp(t.form)}}},[t._v("取消")]):t._e(),t._v(" "),a("p",{staticClass:"txt"},[t._v("阀值说明：当改类型的秘钥剩余数量少于当前设置的数值时，系统将会在主要发出警报标志，提示管理员，该类秘钥库存不足，需要补充。")])],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"edit"!=t.act,expression:'act!="edit"'}]},[a("Form",{ref:"form",attrs:{model:t.form,rules:t.rule,"label-position":"right","label-width":80}},[a("FormItem",{staticStyle:{width:"45%"},attrs:{label:"产品名称:",prop:"productKey"}},[a("Select",{staticClass:"input marginRight",attrs:{placeholder:"产品名称",clearable:""},model:{value:t.form.productKey,callback:function(e){t.$set(t.form,"productKey",e)},expression:"form.productKey"}},t._l(t.productAbleList,function(e){return a("Option",{key:e.productKey,attrs:{value:e.productKey}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("FormItem",{staticStyle:{width:"45%"},attrs:{label:"设置阀值:",prop:"warnCount"}},[a("InputNumber",{staticClass:"input",attrs:{size:"large",placeholder:"请输入阀值",precision:0},model:{value:t.form.warnCount,callback:function(e){t.$set(t.form,"warnCount",e)},expression:"form.warnCount"}})],1)],1)],1),t._v(" "),t.modalLoading?a("Spin",{attrs:{fix:"",large:""}}):t._e()],1)],1)};c._withStripped=!0;var d={render:c,staticRenderFns:[]},u=d;var p=!1;var f=a("C7Lr")(l,u,!1,function(t){p||a("KsIq")},"data-v-1fdb2943",null);f.options.__file="src/views/key/keyList.vue";e.default=f.exports}});
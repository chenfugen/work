webpackJsonp([15],{"9e4H":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("3cXf"),r=i.n(o),n=i("4YfN"),a=i.n(n),s=i("B0rZ"),l={name:"roleList",data:function(){var e=this;return{permission:{disable:!1,info:!1,delete:!1,add:!1},menu:s.a,pageNum:1,pageSize:10,total:0,proLineDisable:!0,tableLoading:!1,formLoading:!0,dialog:!1,rule:{roleName:{required:!0,message:"角色名称不能为空",trigger:"blur"}},form:{roleName:"",roleFlag:0,permissions:[]},filter:{roleName:""},listData:[],permissionList:[],roleList:[],columns:[{title:"序号",type:"index"},{title:"角色名称",key:"roleName",render:function(t,i){return t("div",[t("span",e.dealNull(i.row.roleName))])}},{title:"创建时间",key:"createTime",render:function(t,i){return t("div",[t("span",e.dealNull(i.row.createTime))])}},{title:"角色属性",key:"roleFlag",render:function(e,t){return e("div",[e("span","1"==t.row.roleFlag?"全局":"0"==t.row.roleFlag?"非全局":"--")])}},{title:"角色状态",key:"roleFlag",render:function(e,t){return e("div",[e("span",{style:{color:"1"==t.row.forbidden?"green":"red"}},"1"==t.row.forbidden?"启用":"禁用")])}},{title:"操作",key:"action",width:250,align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:1==i.row.forbidden?"error":"success",disabled:"root"==i.row.id,size:"small"},style:{display:e.permission.disable?"inline-block":"none",marginLeft:"5px"},on:{click:function(){e.handleDisabled(i.row)}}},1==i.row.forbidden?"禁用":"启用"),t("Button",{props:{type:"primary",disabled:"root"==i.row.id||1==i.row.forbidden,size:"small"},style:{display:e.permission.info?"inline-block":"none",marginLeft:"5px"},on:{click:function(){e.goInfo(i.row)}}},"查看"),t("Button",{props:{type:"error",disabled:"root"==i.row.id||1==i.row.forbidden,size:"small"},style:{display:e.permission.delete?"inline-block":"none",marginLeft:"5px"},on:{click:function(){e.handleDelete(i.row)}}},"删除")])}}]}},mounted:function(){this.getTableData(),this.getPermissionList()},methods:{getTableData:function(){this.tableLoading=!0;var e=this.$api.manage_role_list,t=a()({pageNum:this.pageNum,pageSize:this.pageSize},this.filter);this.$refs.HDTable.getListData(e,t)},goInfo:function(e){this.$router.push({path:"/system/roleInfo",name:"roleInfo",query:{roleId:e.id}})},handleAdd:function(){this.cancel(),this.act="add",this.dialogTitle="新增角色",this.dialog=!0},handleDelete:function(e){var t=this;this.$Modal.confirm({title:"提示",content:"<p>确认删除该角色（角色："+e.roleName+"）？</p>",onOk:function(){var i=t.$api.manage_role_delete,o={roleId:e.id};t.$Ax.post(i,o).then(function(e){e.data.success&&(t.$Message.success("删除成功。"),t.getTableData())}).catch(function(e){console.log(e)})},onCancel:function(){t.$Message.success("已取消删除。")}})},handleDisabled:function(e){var t=this,i=this.$api.manage_role_forbidden,o="1"==e.forbidden?"禁用":"启用",r={id:e.id,forbidden:"1"==e.forbidden?"0":"1"};this.$Modal.confirm({title:"警告",content:"<p>确认"+o+"该角色（角色："+e.roleName+"）？</p>",onOk:function(){t.selectCLoading=!0,t.$Ax.post(i,r).then(function(e){t.$Message.success(o+"成功。"),t.getTableData()}).catch(function(e){console.log(e)})},onCancel:function(){t.$Message.success("已取消禁用。")}})},handleDealTree:function(e){var t=[],i=!1;for(var o in e)for(var r in s.a)if(i=!1,e[o].title==s.a[r].title){for(var n in t)e[o].title==t[n].title&&(i=!0);i||t.push(e[o])}return t},submit:function(){var e=this,t=this.$api.manage_role_create;if(this.form.permissions=this.handleDealTree(this.$refs.tree.getCheckedNodes()),this.form.permissions.length<1)return this.$Message.error("请至少选择一项权限。"),this.changeLoading();var i={roleName:this.form.roleName,permissions:r()(this.form.permissions),roleFlag:this.form.roleFlag,factoryId:this.form.factoryId,productLineId:this.form.productLineId};this.$refs.form.validate(function(o){if(!o)return e.changeLoading();e.$Ax.post(t,i).then(function(t){t.data.success&&(e.$Message.success("添加角色成功。"),e.getTableData(),e.dialog=!1)}).catch(function(e){console.log(e)}),setTimeout(function(){e.changeLoading()},1e3)})},cancel:function(){this.$refs.form.resetFields(),this.clearTree(this.menu)},clearTree:function(e){for(var t in e)for(var i in e[t].checked=!1,e[t].children)for(var o in e[t].children[i].checked=!1,e[t].children[i].children)e[t].children[i].children[o].checked=!1;return e},changeLoading:function(){var e=this;this.formLoading=!1,this.$nextTick(function(){e.formLoading=!0})},dealNull:function(e){return""===e||null===e?"--":e},getPermissionList:function(){var e=JSON.parse(sessionStorage.getItem("menu"));for(var t in e)if("系统管理"==e[t].name)for(var i in e[t].children)if("角色列表"==e[t].children[i].name){var o=e[t].children[i].children;for(var r in o)"角色禁用"==o[r].name&&(this.permission.disable=o[r].checked),"角色详细"==o[r].name&&(this.permission.info=o[r].checked),"角色删除"==o[r].name&&(this.permission.delete=o[r].checked),"角色新增"==o[r].name&&(this.permission.add=o[r].checked)}}}},c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"roleList"}},[i("div",{staticClass:"actBox clearfloat"},[i("Button",{staticClass:"left",attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),e.permission.add?i("Button",{staticClass:"right",attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]):e._e()],1),e._v(" "),i("div",{staticClass:"filterbox"},[i("Input",{staticClass:"input",attrs:{placeholder:"角色名称",clearable:""},model:{value:e.filter.roleName,callback:function(t){e.$set(e.filter,"roleName",t)},expression:"filter.roleName"}})],1),e._v(" "),i("div",{staticClass:"table clearfloat marginTop"},[i("HDTable",{ref:"HDTable",attrs:{columns:e.columns}})],1),e._v(" "),i("Modal",{attrs:{title:"编辑",loading:e.formLoading},on:{"on-ok":e.submit,"on-cancel":e.cancel},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[i("Form",{ref:"form",attrs:{model:e.form,rules:e.rule,"label-position":"right","label-width":120}},[i("FormItem",{attrs:{prop:"roleName",label:"角色名称:"}},[i("Input",{staticClass:"input",model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}})],1),e._v(" "),i("FormItem",{attrs:{prop:"roleFlag",label:"角色类型(是否全局):"}},[i("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.form.roleFlag,callback:function(t){e.$set(e.form,"roleFlag",t)},expression:"form.roleFlag"}},[i("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),i("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),i("FormItem",{attrs:{prop:"permissions",label:"权限列表:"}},[i("Tree",{ref:"tree",staticStyle:{"margin-left":"70px"},attrs:{data:e.menu,"empty-text":"暂无数据","show-checkbox":""}})],1)],1)],1)],1)};c._withStripped=!0;var d={render:c,staticRenderFns:[]},f=d;var m=!1;var u=i("C7Lr")(l,f,!1,function(e){m||i("P9qz")},"data-v-70afd4ea",null);u.options.__file="src/views/system/roleList.vue";t.default=u.exports},P9qz:function(e,t,i){var o=i("dswZ");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);i("FIqI")("0e43c636",o,!1,{})},dswZ:function(e,t,i){(e.exports=i("UTlt")(!0)).push([e.i,"\n.actBox[data-v-70afd4ea] {\n\tmargin-bottom: 20px;\n}\n","",{version:3,sources:["/Users/nelson/workspace/qinyuan-chance-farm-web/static-files/src/views/system/roleList.vue"],names:[],mappings:";AACA;CACC,oBAAoB;CACpB",file:"roleList.vue",sourcesContent:["\n.actBox[data-v-70afd4ea] {\n\tmargin-bottom: 20px;\n}\n"],sourceRoot:""}])}});
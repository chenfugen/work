webpackJsonp([10],{"7r3Z":function(e,t,a){var i=a("naKw");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("FIqI")("1dc9a6ad",i,!1,{})},JRsp:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("4YfN"),o=a.n(i),r={name:"userList",data:function(){var e=this;return{permission:{edit:!1,disable:!1,rePassword:!1,add:!1,delete:!1},act:"",dialogTitle:"",showFactory:!1,proLineDisable:!0,dialog:!1,dialogLoading:!1,formLoading:!0,form:{factoryId:"",productLineId:"",userName:"",realName:"",password:"",repassword:"",roleId:""},filter:{roleId:"",accountName:""},rule:{userName:{required:!0,message:"用户名称不能为空",trigger:"blur"},realName:{required:!0,message:"真实姓名不能为空",trigger:"blur"},password:{required:!0,message:"登陆密码不能为空",trigger:"blur"},repassword:[{validator:function(t,a,i){""==a?i(new Error("请确认登陆密码")):a!==e.form.password?i(new Error("两次输入密码不一致!")):i()},trigger:"blur"}],roleId:{required:!0,message:"用户角色不能为空",trigger:"blur"}},factoryList:[],productLineList:[],roleList:[],listData:[],columns:[{title:"序号",type:"index"},{title:"用户名称",key:"userName",render:function(t,a){return t("div",[t("span",e.dealNull(a.row.userName))])}},{title:"真实姓名",key:"realName",render:function(t,a){return t("div",[t("span",e.dealNull(a.row.realName))])}},{title:"角色",key:"roleName",render:function(t,a){return t("div",[t("span",e.dealNull(a.row.roleName))])}},{title:"工厂",key:"factoryName",render:function(t,a){return t("div",[t("span",e.dealNull(a.row.factoryName))])}},{title:"产线",key:"productLineName",render:function(t,a){return t("div",[t("span",e.dealNull(a.row.productLineName))])}},{title:"最后登录时间",key:"lastOnlineTime",render:function(t,a){return t("div",[t("span",e.dealNull(a.row.lastOnlineTime))])}},{title:"状态",key:"forbidden",render:function(e,t){return e("div",[e("span",{style:{color:"1"==t.row.forbidden?"green":"red"}},"1"==t.row.forbidden?"启用":"禁用")])}},{title:"操作",key:"action",width:250,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:0==a.row.forbidden?"success":"error",disabled:"root"==a.row.roleId,size:"small"},style:{display:e.permission.disable?"inlin-block":"none",marginRight:"5px"},on:{click:function(){e.handleDisable(a.row)}}},0==a.row.forbidden?"启用":"禁用"),t("Button",{props:{type:"primary",disabled:0!=a.row.forbidden||"root"==a.row.roleId,size:"small"},style:{display:e.permission.edit?"inlin-block":"none",marginRight:"5px"},on:{click:function(){e.handleEdit(a.row)}}},"编辑"),t("Button",{props:{type:"primary",disabled:0!=a.row.forbidden||"root"==a.row.roleId,size:"small"},style:{display:e.permission.rePassword?"inlin-block":"none",marginRight:"5px"},on:{click:function(){e.handleEditPWD(a.row)}}},"重置密码"),t("Button",{props:{type:"error",disabled:0!=a.row.forbidden||"root"==a.row.roleId,size:"small"},style:{display:e.permission.delete?"inlin-block":"none"},on:{click:function(){e.handleDelete(a.row)}}},"删除")])}}]}},mounted:function(){this.getTableData(),this.getRoleList(),this.getPermissionList()},watch:{form:{handler:function(e,t){""==e.factoryId||void 0==e.factoryId?this.proLineDisable=!0:(this.proLineDisable=!1,this.getProductLineList(e.factoryId)),""==e.roleId||void 0==e.roleId?this.showFactory=!1:this.checkRole(e.roleId)},deep:!0}},methods:{getTableData:function(){var e=this.$api.manage_userAccount_list;this.tableLoading=!0;var t=o()({},this.filter);this.$refs.HDTable.getListData(e,t)},getRoleList:function(){var e=this,t=this.$api.common_account_role_list;this.$Ax.get(t,{params:{pageNum:1,pageSize:100}}).then(function(t){for(var a in e.roleList=[],t.data.data)"root"!=t.data.data[a].id&&e.roleList.push(t.data.data[a])}).catch(function(e){console.log(e)})},getFactoryList:function(){var e=this,t=this.$api.manage_factory_getFactoryList;this.$Ax.get(t,{params:{pageNum:1,pageSize:100}}).then(function(t){e.factoryList=t.data.data}).catch(function(e){console.log(e)})},getProductLineList:function(e){var t=this,a=this.$api.manage_productLine_getProductLineList,i={pageNum:1,pageSize:100,factoryId:e};this.$Ax.get(a,{params:i}).then(function(e){t.productLineList=e.data.data}).catch(function(e){console.log(e)})},handleDelete:function(e){var t=this;this.$Modal.confirm({title:"提示",content:"<p>确认删除该用户（用户："+e.userName+"）？</p>",onOk:function(){var a=t.$api.manage_userAccount_delete,i={id:e.id};t.$Ax.post(a,i).then(function(e){e.data.success&&(t.$Message.success("删除成功。"),t.getTableData())}).catch(function(e){console.log(e)})},onCancel:function(){t.$Message.success("已取消删除。")}})},handleEdit:function(e){var t=this;this.getFactoryList(),this.cancel(),this.dialogLoading=!0,this.dialogTitle="编辑",this.dialog=!0,this.act="edit";var a=this.$api.manage_userAccount_userDetail,i={id:e.id};this.$Ax.get(a,{params:i}).then(function(e){t.form=e.data.data,t.form.repassword=t.form.password,t.dialogLoading=!1}).catch(function(e){console.log(e)})},handleDisable:function(e){var t=this,a=0==e.forbidden?"启用":"禁用",i=0==e.forbidden?this.$api.manage_userAccount_used:this.$api.manage_userAccount_forbidden,o={id:e.id};this.$Modal.confirm({title:"提示",content:"<p>确认"+a+"该用户（用户："+e.userName+"）？</p>",onOk:function(){t.$Ax.post(i,o).then(function(e){e.data.success&&(t.$Message.success(a+"成功。"),t.getTableData())}).catch(function(e){console.log(e)})},onCancel:function(){t.$Message.success("已取消。")}})},handleAdd:function(){this.getFactoryList(),this.cancel(),this.dialog=!0,this.dialogLoading=!1,this.dialogTitle="添加",this.act="add"},handleEditPWD:function(e){var t=this;this.$Modal.confirm({title:"提示",content:"<p>确认重置该用户密码（用户："+e.userName+"）？</p>",onOk:function(){var a=t.$api.manage_userAccount_reset_password,i={id:e.id,password:"123456"};t.$Ax.post(a,i).then(function(e){e.data.success&&(t.$Message.success("重置密码成功。"),t.getTableData())}).catch(function(e){console.log(e)})},onCancel:function(){t.$Message.success("已取消重置密码。")}})},submit:function(){var e=this,t="",a="",i="";"add"==this.act?(i="添加用户成功。",t=this.$api.manage_userAccount_create,a=this.form):(i="编辑用户成功。",t=this.$api.manage_userAccount_update,a=this.form),this.$refs.form.validate(function(o){if(!o)return e.changeLoading();"edit"==e.act&&(a.password=""),e.$Ax.post(t,a).then(function(t){t.data.success&&(e.$Message.success(i),e.getTableData(),e.dialog=!1)}).catch(function(e){console.log(e)}),setTimeout(function(){e.changeLoading()},1e3)})},cancel:function(){this.$refs.form.resetFields()},changeLoading:function(){var e=this;this.formLoading=!1,this.$nextTick(function(){e.formLoading=!0})},checkRole:function(e){var t=this;this.dialogLoading=!0;var a=this.$api.manage_role_detail,i={roleId:e};this.$Ax.get(a,{params:i}).then(function(e){"1"==e.data.data.roleFlag?t.showFactory=!1:t.showFactory=!0,t.dialogLoading=!1}).catch(function(e){console.log(e)})},dealNull:function(e){return""===e||null===e?"--":e},getPermissionList:function(){var e=JSON.parse(sessionStorage.getItem("menu"));for(var t in e)if("系统管理"==e[t].name)for(var a in e[t].children)if("用户列表"==e[t].children[a].name){var i=e[t].children[a].children;for(var o in i)"用户禁用"==i[o].name&&(this.permission.disable=i[o].checked),"用户编辑"==i[o].name&&(this.permission.edit=i[o].checked),"重置密码"==i[o].name&&(this.permission.rePassword=i[o].checked),"用户删除"==i[o].name&&(this.permission.delete=i[o].checked),"用户新增"==i[o].name&&(this.permission.add=i[o].checked)}}}},s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"userList"}},[a("div",{staticClass:"actBox clearfloat"},[a("Button",{staticClass:"left",attrs:{type:"primary"},on:{click:e.getTableData}},[e._v("查询")]),e._v(" "),e.permission.add?a("Button",{staticClass:"right",attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]):e._e()],1),e._v(" "),a("div",{staticClass:"filterbox"},[a("Input",{staticClass:"input marginRight",attrs:{placeholder:"用户名称",clearable:""},model:{value:e.filter.accountName,callback:function(t){e.$set(e.filter,"accountName",t)},expression:"filter.accountName"}}),e._v(" "),a("Select",{staticClass:"input marginRight",attrs:{placeholder:"角色名称",clearable:""},model:{value:e.filter.roleId,callback:function(t){e.$set(e.filter,"roleId",t)},expression:"filter.roleId"}},e._l(e.roleList,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.roleName))])}))],1),e._v(" "),a("div",{staticClass:"table clearfloat marginTop"},[a("HDTable",{ref:"HDTable",attrs:{columns:e.columns}})],1),e._v(" "),a("Modal",{staticStyle:{position:"relative"},attrs:{title:e.dialogTitle,loading:e.formLoading},on:{"on-ok":e.submit,"on-cancel":e.cancel},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("Form",{ref:"form",attrs:{model:e.form,rules:e.rule,"label-position":"right","label-width":80}},[a("FormItem",{attrs:{prop:"userName",label:"用户名称:"}},[a("Input",{staticClass:"input",model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1),e._v(" "),a("FormItem",{attrs:{prop:"realName",label:"真实姓名:"}},[a("Input",{staticClass:"input",model:{value:e.form.realName,callback:function(t){e.$set(e.form,"realName",t)},expression:"form.realName"}})],1),e._v(" "),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:"add"==e.act,expression:'act=="add"'}],attrs:{prop:"password",label:"登录密码:"}},[a("Input",{staticClass:"input",attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:"add"==e.act,expression:'act=="add"'}],attrs:{prop:"repassword",label:"确认密码:"}},[a("Input",{staticClass:"input",attrs:{type:"password"},model:{value:e.form.repassword,callback:function(t){e.$set(e.form,"repassword",t)},expression:"form.repassword"}})],1),e._v(" "),a("FormItem",{attrs:{prop:"roleId",label:"用户角色:"}},[a("Select",{staticClass:"input marginRight",attrs:{clearable:""},model:{value:e.form.roleId,callback:function(t){e.$set(e.form,"roleId",t)},expression:"form.roleId"}},e._l(e.roleList,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.roleName))])}))],1),e._v(" "),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.showFactory,expression:"showFactory"}],attrs:{prop:"factoryId",label:"工厂:"}},[a("Select",{staticClass:"input marginRight",attrs:{clearable:""},model:{value:e.form.factoryId,callback:function(t){e.$set(e.form,"factoryId",t)},expression:"form.factoryId"}},e._l(e.factoryList,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.factoryName))])}))],1),e._v(" "),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.showFactory,expression:"showFactory"}],attrs:{prop:"productLineId",label:"产线:"}},[a("Select",{staticClass:"input marginRight",attrs:{disabled:e.proLineDisable,clearable:""},model:{value:e.form.productLineId,callback:function(t){e.$set(e.form,"productLineId",t)},expression:"form.productLineId"}},e._l(e.productLineList,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.productLineName))])}))],1)],1),e._v(" "),e.dialogLoading?a("Spin",{attrs:{fix:""}}):e._e()],1)],1)};s._withStripped=!0;var n={render:s,staticRenderFns:[]},l=n;var c=!1;var d=a("C7Lr")(r,l,!1,function(e){c||a("7r3Z")},"data-v-9661c982",null);d.options.__file="src/views/system/userList.vue";t.default=d.exports},naKw:function(e,t,a){(e.exports=a("UTlt")(!0)).push([e.i,"\n.actBox[data-v-9661c982] {\n\tmargin-bottom: 20px;\n}\n","",{version:3,sources:["/Users/nelson/workspace/qinyuan-chance-farm-web/static-files/src/views/system/userList.vue"],names:[],mappings:";AACA;CACC,oBAAoB;CACpB",file:"userList.vue",sourcesContent:["\n.actBox[data-v-9661c982] {\n\tmargin-bottom: 20px;\n}\n"],sourceRoot:""}])}});
webpackJsonp([6],{Dlb0:function(n,t,e){var a=e("QyQF");"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);e("FIqI")("1d8c6e62",a,!1,{})},QyQF:function(n,t,e){(n.exports=e("UTlt")(!0)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","",{version:3,sources:[],names:[],mappings:"",file:"chance.vue",sourceRoot:""}])},vtHn:function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={name:"roleInfo",data:function(){var n=this;return{pageNum:1,total:0,pageSize:10,dialogTitle:"",act:"",dialog:!1,formLoading:!0,tableLoading:!1,dialogLoading:!1,pageLoading:!1,productLoading:!1,filterProLineDisable:!0,formProLineDisable:!0,rule:{productKey:[{required:!0,message:"请选择产品",trigger:"blur"}],planTotal:[],factoryId:[{required:!0,message:"请选择输属工厂",trigger:"blur"}],productLineId:[{required:!0,message:"请选择所属产线",trigger:"blur"}]},infoForm:{status:"",updateTime:"",productName:"",productKey:"",erpCode:"",workOrderCode:"",productLineName:"",productLineCode:""},form:{productKey:"",workOrderCode:"",planTotal:0,factoryId:"",productLineId:""},filter:{productKey:"",erpCode:"",workOrderCode:"",factoryId:"",productLineCode:"",status:"",time:""},productList:[],ableProductList:[],factoryList:[],productLineList:[],columns:[{title:"产品名称",align:"center",key:"productName",fixed:"left",width:200,render:function(t,e){return t("div",[t("span",n.dealData(e.row.productName))])}},{title:"工单号",align:"center",key:"workOrderCode",fixed:"left",width:150,render:function(t,e){return t("div",[t("Button",{props:{type:"text",size:"small"},style:{color:"blue"},on:{click:function(){n.getInfo(e.row)}}},n.dealData(e.row.workOrderCode))])}},{title:"ERP编号",align:"center",fixed:"left",key:"erpcode",width:150,render:function(t,e){return t("div",[t("span",n.dealData(e.row.erpcode))])}},{title:"所属产线",align:"center",key:"productLineName",width:150,render:function(t,e){return t("div",[t("span",n.dealData(e.row.productLineName))])}},{title:"所属工厂",align:"center",key:"factoryName",width:150,render:function(t,e){return t("div",[t("span",n.dealData(e.row.factoryName))])}},{title:"计划总量",align:"center",key:"planTotal",width:150,render:function(t,e){return t("div",[t("span",n.dealData(e.row.planTotal))])}},{title:"实际量",align:"center",key:"finishedTotal",width:150,render:function(t,e){return t("div",[t("span",n.dealData(e.row.finishedTotal))])}},{title:"最后检测时间",align:"center",width:200,key:"updateTime",render:function(t,e){return t("div",[t("span",n.dealData(e.row.updateTime))])}},{title:"任务状态",key:"status",align:"center",width:100,render:function(n,t){return n("div",[n("span",{style:{color:0==t.row.status?"green":1==t.row.status?"green":"red"}},0==t.row.status?"新建":1==t.row.status?"进行中":"结束")])}},{title:"操作",key:"erpCode",align:"center",fixed:"right",width:100,render:function(t,e){return t("div",[t("Button",{props:{type:"success",size:"small",disabled:"2"==e.row.status},on:{click:function(){n.handleStart(e.row)}}},"开始产测")])}},{title:"操作",key:"action",align:"center",fixed:"right",width:200,render:function(t,e){return t("div",[t("Button",{props:{type:"primary",size:"small"},on:{click:function(){n.getInfo(e.row)}}},"查看"),t("Button",{props:{type:"2"==e.row.status?"success":"error",size:"small"},style:{marginLeft:"5px"},on:{click:function(){n.handleFinish(e.row)}}},"2"==e.row.status?"开启":"结束"),t("Button",{props:{type:"error",disabled:0!=e.row.status,size:"small"},style:{marginLeft:"5px"},on:{click:function(){n.handleDelete(e.row)}}},"删除")])}}]}},mounted:function(){this.pageNum=1,this.pageSize=10,this.getTableData(),this.getFactoryList(),this.getProductList(),this.remoteProductList("")},watch:{filter:{handler:function(n,t){""==n.factoryId||void 0==n.factoryId?(this.filterProLineDisable=!0,this.$refs.filterSelect.clearSingleSelect()):this.filterProLineDisable=!1},deep:!0},form:{handler:function(n,t){""==n.factoryId||void 0==n.factoryId?(this.formProLineDisable=!0,this.$refs.formSelect.clearSingleSelect()):this.formProLineDisable=!1},deep:!0}},methods:{getTableData:function(){var n=""!=this.filter.time[0]?this.$Utils.formatDate.format(this.filter.time[0],"yyyy-MM-dd hh:mm:ss"):"",t=""!=this.filter.time[1]?this.$Utils.formatDate.format(this.filter.time[1],"yyyy-MM-dd hh:mm:ss"):"";this.tableLoading=!0;var e=this.$api.manage_productionTask_getProductionTaskList,a={productKey:this.filter.productKey,productName:this.filter.productName,erpCode:this.filter.erpCode,workOrderCode:this.filter.workOrderCode,productLineCode:this.filter.productLineCode,status:this.filter.status,startTime:n,endTime:t};this.$refs.HDTable.getListData(e,a)},getInfo:function(n){var t=this;this.dialogLoading=!0,this.dialogTitle="查看任务详情",this.act="info",this.dialog=!0;var e=this.$api.manage_productionTask_getProductionTaskInfo,a={id:n.id};this.$Ax.get(e,{params:a}).then(function(n){t.infoForm=n.data.data,t.dialogLoading=!1}).catch(function(n){console.log(n)})},getFactoryList:function(){var n=this,t=this.$api.manage_factory_getFactoryList;this.$Ax.get(t,{params:{pageNum:1,pageSize:100,status:1}}).then(function(t){n.factoryList=t.data.data}).catch(function(n){console.log(n)})},getProductList:function(){var n=this,t=this.$api.manage_product_list;this.$Ax.get(t,{params:{pageNum:1,pageSize:100,qcForbidden:1}}).then(function(t){n.productList=t.data.data}).catch(function(n){console.log(n)})},getProductLineList:function(n){var t=this,e=this.$api.manage_productLine_getProductLineList,a={pageNum:1,pageSize:100,factoryId:n,status:1};this.$Ax.get(e,{params:a}).then(function(n){t.productLineList=n.data.data}).catch(function(n){console.log(n)})},handleAdd:function(){this.dialogTitle="新建任务",this.act="add",this.dialog=!0},handleDelete:function(n){var t=this;this.$Modal.confirm({title:"提示",content:"<p>确认删除该任务？</p>",onOk:function(){var e=t.$api.manage_productionTask_deleteProductionTask,a={id:n.id};t.$Ax.post(e,a).then(function(n){n.data.success&&(t.$Message.success("删除成功。"),t.getTableData())}).catch(function(n){console.log(n)})},onCancel:function(){t.$Message.success("已取消删除。")}})},handleFinish:function(n){var t=this,e=this.$api.manage_productionTask_forbidden,a={},r="";2==n.status?(a={id:n.id,status:1},r="开启"):(a={id:n.id,status:2},r="结束"),this.$Modal.confirm({title:"提示",content:"<p>确认"+r+"该任务？</p>",onOk:function(){t.$Ax.post(e,a).then(function(n){n.data.success&&(t.$Message.success("已"+r+"任务。"),t.getTableData())}).catch(function(n){console.log(n)})},onCancel:function(){t.$Message.success("已取消"+r+"。")}})},handleStart:function(n){var t=this;this.$Modal.confirm({title:"提示",content:"<p>确认开始产测？</p>",onOk:function(){var e=t.$api.manage_productionTask_forbidden,a={id:n.id,status:1};t.$Ax.post(e,a).then(function(e){e.data.success&&t.$router.push({push:"/ChanceStart",name:"chanceStart",query:{id:n.id,taskProductKey:n.productKey}})}).catch(function(n){console.log(n)})},onCancel:function(){t.$Message.success("已取消开启。")}})},remoteProductList:function(n){var t=this;this.productLoading=!0;var e=this.$api.manage_product_productList,a={productName:n};this.$Ax.get(e,{params:a}).then(function(n){var e=n.data.data;for(var a in t.ableProductList=[],e){var r={name:e[a].split("-HadLinks-")[0],productKey:e[a].split("-HadLinks-")[1]};t.ableProductList.push(r)}t.productLoading=!1}).catch(function(n){console.log(n)})},submit:function(){var n=this;if("info"==this.act)this.dialog=!1;else{var t=this.$api.manage_productionTask_saveProductionTask,e={productKey:this.form.productKey,workOrderCode:this.form.workOrderCode,planTotal:this.form.planTotal,factoryId:this.form.factoryId,productLineId:this.form.productLineId};this.$refs.form.validate(function(a){if(!a)return n.changeLoading();n.$Ax.post(t,e).then(function(t){t.data.success&&(n.$Message.success("添加任务成功。"),n.getTableData(),n.dialog=!1)}).catch(function(n){console.log(n)}),setTimeout(function(){n.changeLoading()},1e3)})}},cancel:function(){this.$refs.form.resetFields(),this.$refs.infoForm.resetFields()},changeLoading:function(){var n=this;this.formLoading=!1,this.$nextTick(function(){n.formLoading=!0})},dealData:function(n){return""===n||null===n?"--":n}}},r=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"clearfloat",staticStyle:{position:"relative"},attrs:{id:"roleInfo"}},[e("div",{staticClass:"actBox clearfloat"},[e("Button",{staticClass:"left",attrs:{type:"primary"},on:{click:n.getTableData}},[n._v("查询")]),n._v(" "),e("Button",{staticClass:"right",attrs:{type:"primary"},on:{click:n.handleAdd}},[n._v("新建任务")])],1),n._v(" "),e("div",{staticClass:"filterbox marginTop"},[e("Form",{ref:"filter",staticClass:"clearfloat",attrs:{model:n.filter,"label-width":0}},[e("FormItem",{staticClass:"input left marginRight",attrs:{prop:"productKey"}},[e("Select",{staticClass:"input marginRight",attrs:{placeholder:"产品名称",clearable:""},model:{value:n.filter.productKey,callback:function(t){n.$set(n.filter,"productKey",t)},expression:"filter.productKey"}},n._l(n.productList,function(t){return e("Option",{key:t.productKey,attrs:{value:t.productKey}},[n._v(n._s(t.name))])}))],1),n._v(" "),e("FormItem",{staticClass:"input left marginRight",attrs:{prop:"erpCode"}},[e("Input",{staticClass:"input",attrs:{placeholder:"ERP编号"},model:{value:n.filter.erpCode,callback:function(t){n.$set(n.filter,"erpCode",t)},expression:"filter.erpCode"}})],1),n._v(" "),e("FormItem",{staticClass:"input left marginRight",attrs:{prop:"workOrderCode"}},[e("Input",{staticClass:"input",attrs:{placeholder:"工单号"},model:{value:n.filter.workOrderCode,callback:function(t){n.$set(n.filter,"workOrderCode",t)},expression:"filter.workOrderCode"}})],1),n._v(" "),e("FormItem",{staticClass:"input left marginRight",attrs:{prop:"factoryId"}},[e("Select",{staticClass:"input marginRight",attrs:{placeholder:"所属工厂",clearable:""},on:{"on-change":n.getProductLineList},model:{value:n.filter.factoryId,callback:function(t){n.$set(n.filter,"factoryId",t)},expression:"filter.factoryId"}},n._l(n.factoryList,function(t){return e("Option",{key:t.id,attrs:{value:t.id}},[n._v(n._s(t.factoryName))])}))],1),n._v(" "),e("FormItem",{staticClass:"input left marginRight",attrs:{prop:"productLineCode"}},[e("Select",{ref:"filterSelect",staticClass:"input marginRight",attrs:{disabled:n.filterProLineDisable,placeholder:"所属产线",clearable:""},model:{value:n.filter.productLineCode,callback:function(t){n.$set(n.filter,"productLineCode",t)},expression:"filter.productLineCode"}},n._l(n.productLineList,function(t){return e("Option",{key:t.productLineCode,attrs:{value:t.productLineCode}},[n._v(n._s(t.productLineName))])}))],1),n._v(" "),e("FormItem",{staticClass:"input left marginRight",attrs:{prop:"status"}},[e("Select",{staticClass:"input marginRight",attrs:{placeholder:"任务状态",clearable:""},model:{value:n.filter.status,callback:function(t){n.$set(n.filter,"status",t)},expression:"filter.status"}},[e("Option",{attrs:{value:0}},[n._v("新建")]),n._v(" "),e("Option",{attrs:{value:1}},[n._v("进行中")]),n._v(" "),e("Option",{attrs:{value:2}},[n._v("结束")])],1)],1),n._v(" "),e("FormItem",{staticClass:"input left marginRight",attrs:{prop:"time"}},[e("DatePicker",{staticClass:"input",attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss",placeholder:"最后检测时间",clearable:""},model:{value:n.filter.time,callback:function(t){n.$set(n.filter,"time",t)},expression:"filter.time"}})],1)],1)],1),n._v(" "),e("div",{staticStyle:{position:"relative"}},[e("HDTable",{ref:"HDTable",attrs:{columns:n.columns}})],1),n._v(" "),e("Modal",{staticStyle:{position:"relative"},attrs:{title:n.dialogTitle,loading:n.formLoading,width:"45"},on:{"on-ok":n.submit,"on-cancel":n.cancel},model:{value:n.dialog,callback:function(t){n.dialog=t},expression:"dialog"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:"info"==n.act,expression:'act=="info"'}],staticClass:"infoBox"},[e("Form",{ref:"infoForm",staticClass:"clearfloat",attrs:{model:n.infoForm,"label-position":"right","label-width":150}},[e("div",{staticClass:"left",staticStyle:{width:"50%"}},[e("FormItem",{attrs:{prop:"status",label:"任务状态:"}},[e("span",[n._v(n._s(n.dealData("0"==n.infoForm.status?"新建":"1"==n.infoForm.status?"进行中":"结束")))])]),n._v(" "),e("FormItem",{attrs:{prop:"updateTime",label:"状态更新时间:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.updateTime)))])]),n._v(" "),e("FormItem",{attrs:{prop:"productName",label:"产品名称:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.productName)))])]),n._v(" "),e("FormItem",{attrs:{prop:"productKey",label:"ProductKey:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.productKey)))])]),n._v(" "),e("FormItem",{attrs:{prop:"erpCode",label:"ERP编码:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.erpCode)))])]),n._v(" "),e("FormItem",{attrs:{prop:"workOrderCode",label:"工单号:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.workOrderCode)))])]),n._v(" "),e("FormItem",{attrs:{prop:"productLineName",label:"所属产线:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.productLineName))+"线")])]),n._v(" "),e("FormItem",{attrs:{prop:"productLineCode",label:"产线代码:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.productLineCode)))])])],1),n._v(" "),e("div",{staticClass:"left"},[e("FormItem",{attrs:{prop:"factoryName",label:"所属工厂:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.factoryName)))])]),n._v(" "),e("FormItem",{attrs:{prop:"factoryCode",label:"工厂代码:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.factoryCode)))])]),n._v(" "),e("FormItem",{attrs:{prop:"planTotal",label:"计划总量:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.planTotal)))])]),n._v(" "),e("FormItem",{attrs:{prop:"finishedTotal",label:"实际完成量:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.finishedTotal)))])]),n._v(" "),e("FormItem",{attrs:{prop:"updateTime",label:"最后检测时间:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.updateTime)))])]),n._v(" "),e("FormItem",{attrs:{prop:"createTime",label:"创建时间:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.createTime)))])]),n._v(" "),e("FormItem",{attrs:{prop:"createBy",label:"创建者:"}},[e("span",[n._v(n._s(n.dealData(n.infoForm.userName)))])])],1)]),n._v(" "),n.dialogLoading?e("Spin",{attrs:{fix:""}}):n._e()],1),n._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"add"==n.act,expression:'act=="add"'}],staticClass:"addBox"},[e("Form",{ref:"form",attrs:{model:n.form,rules:n.rule,"label-position":"right","label-width":150}},[e("FormItem",{attrs:{prop:"productKey",label:"产品名称:"}},[e("Select",{staticClass:"input marginRight",attrs:{loading:n.productLoading,placeholder:"产品名称",filterable:"",remote:"","remote-method":n.remoteProductList,clearable:""},model:{value:n.form.productKey,callback:function(t){n.$set(n.form,"productKey",t)},expression:"form.productKey"}},n._l(n.ableProductList,function(t){return e("Option",{key:t.productKey,attrs:{value:t.productKey}},[n._v(n._s(t.name))])}))],1),n._v(" "),e("FormItem",{attrs:{prop:"workOrderCode",label:"工单号:"}},[e("Input",{staticClass:"input",attrs:{placeholder:"工单号"},model:{value:n.form.workOrderCode,callback:function(t){n.$set(n.form,"workOrderCode",t)},expression:"form.workOrderCode"}})],1),n._v(" "),e("FormItem",{attrs:{prop:"planTotal",label:"计划总量:"}},[e("InputNumber",{staticClass:"input",attrs:{precision:0,placeholder:"计划总量"},model:{value:n.form.planTotal,callback:function(t){n.$set(n.form,"planTotal",t)},expression:"form.planTotal"}})],1),n._v(" "),e("FormItem",{attrs:{prop:"factoryId",label:"所属工厂:"}},[e("Select",{staticClass:"input marginRight",attrs:{placeholder:"所属工厂",clearable:""},on:{"on-change":n.getProductLineList},model:{value:n.form.factoryId,callback:function(t){n.$set(n.form,"factoryId",t)},expression:"form.factoryId"}},n._l(n.factoryList,function(t){return e("Option",{key:t.id,attrs:{value:t.id}},[n._v(n._s(t.factoryName))])}))],1),n._v(" "),e("FormItem",{attrs:{prop:"productLineId",label:"所属产线:"}},[e("Select",{ref:"formSelect",staticClass:"input marginRight",attrs:{disabled:n.formProLineDisable,placeholder:"所属产线",clearable:""},model:{value:n.form.productLineId,callback:function(t){n.$set(n.form,"productLineId",t)},expression:"form.productLineId"}},n._l(n.productLineList,function(t){return e("Option",{key:t.id,attrs:{value:t.id}},[n._v(n._s(t.productLineName))])}))],1)],1)],1),n._v(" "),"info"==n.act?e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"primary",name:"button"},on:{click:n.submit}},[n._v("确定")])],1):n._e()]),n._v(" "),n.pageLoading?e("Spin",{attrs:{fixd:""}}):n._e()],1)};r._withStripped=!0;var o={render:r,staticRenderFns:[]},i=o;var s=!1;var l=e("C7Lr")(a,i,!1,function(n){s||e("Dlb0")},"data-v-e7325176",null);l.options.__file="src/views/chance/chance.vue";t.default=l.exports}});